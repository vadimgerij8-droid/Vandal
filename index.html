<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>SAYS UA ¬∑ –º–æ–Ω–æ—Ö—Ä–æ–º–Ω–∏–π –∞–Ω—ñ–º–µ-–∫–∞—Ç–∞–ª–æ–≥</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
    <!-- Plyr CSS (v3.7.8) -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
        }

        /* –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .app {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 20px 80px;
            background-image: 
                radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10,10,10,0.98);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #2a2a2a;
            padding: 16px 0 8px;
            margin-bottom: 20px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            color: #ffffff;
            text-decoration: none;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
            transition: text-shadow 0.2s;
        }

        .logo:hover {
            text-shadow: 0 0 20px rgba(255,255,255,0.6);
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #1a1a1a;
            border-radius: 40px;
            padding: 8px 18px;
            width: 300px;
            border: 1px solid #333;
            transition: border 0.2s, box-shadow 0.2s;
        }

        .search-box:focus-within {
            border-color: #ffffff;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.1);
            background: #1f1f1f;
        }

        .search-box i {
            color: #cccccc;
            margin-right: 10px;
        }

        .search-box input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            outline: none;
            font-size: 0.95rem;
        }

        .search-box input::placeholder {
            color: #777;
        }

        .user-icon {
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.2s;
        }

        .user-icon:hover {
            opacity: 0.7;
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            gap: 32px;
            font-weight: 500;
            border-bottom: 1px solid #222;
            padding-bottom: 8px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            margin-top: 10px;
        }

        .nav-links::-webkit-scrollbar {
            display: none;
        }

        .nav-links a {
            color: #aaa;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.2s;
            cursor: pointer;
            padding-bottom: 8px;
            border-bottom: 2px solid transparent;
        }

        .nav-links a.active {
            color: #ffffff;
            border-bottom-color: #ffffff;
        }

        /* Trending */
        .trending-section {
            margin: 30px 0 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffffff;
        }

        .trending-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 12px;
        }

        .trending-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .trending-scroll::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 10px;
        }

        .trending-scroll::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .trend-card {
            flex: 0 0 160px;
            scroll-snap-align: start;
            background: #151515;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #2a2a2a;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .trend-card:hover {
            transform: translateY(-5px);
            border-color: #ffffff;
            box-shadow: 0 10px 20px rgba(255,255,255,0.05);
        }

        .trend-poster {
            aspect-ratio: 2 / 3;
            background: #1e1e1e;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 2.5rem;
            transition: background 0.2s;
        }

        .trend-card:hover .trend-poster {
            background: #2a2a2a;
        }

        .trend-info {
            padding: 12px;
        }

        .trend-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –§—ñ–ª—å—Ç—Ä–∏ */
        .filter-section {
            margin: 28px 0 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .genre-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chip {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #ccc;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .chip:hover {
            background: #2a2a2a;
            border-color: #ffffff;
            color: white;
            transform: translateY(-2px);
        }

        .chip.active {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
            font-weight: 700;
        }

        .sort-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ffffff;
        }

        .sort-control select {
            background: #1a1a1a;
            border: 1px solid #444;
            color: white;
            padding: 8px 28px 8px 14px;
            border-radius: 30px;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2'><polyline points='6 9 12 15 18 9'/></svg>");
            background-repeat: no-repeat;
            background-position: right 8px center;
        }

        /* –°—ñ—Ç–∫–∞ –∞–Ω—ñ–º–µ */
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 24px 16px;
            margin: 32px 0 48px;
        }

        .movie-card {
            background: #151515;
            border-radius: 20px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s, border-color 0.3s;
            border: 1px solid #2a2a2a;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 30px rgba(255,255,255,0.05);
            border-color: #ffffff;
        }

        .card-poster {
            aspect-ratio: 2 / 3;
            background: #1e1e1e;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 3rem;
            border-bottom: 1px solid #2a2a2a;
            position: relative;
            background-size: cover;
            background-position: center;
            transition: filter 0.3s;
        }

        .movie-card:hover .card-poster {
            filter: brightness(1.1);
        }

        .card-poster span {
            opacity: 0.5;
        }

        .watchlist-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #0a0a0a;
            color: #ffffff;
            font-size: 1rem;
            padding: 5px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ffffff;
            opacity: 0;
            transition: opacity 0.2s, background 0.2s;
        }

        .movie-card:hover .watchlist-badge {
            opacity: 1;
        }

        .watchlist-badge:hover {
            background: #ffffff;
            color: #000000;
        }

        .card-info {
            padding: 14px 12px 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-title {
            font-weight: 700;
            font-size: 1rem;
            line-height: 1.3;
            color: white;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 42px;
        }

        .card-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 6px 8px;
            font-size: 0.8rem;
            color: #aaa;
        }

        .card-year {
            background: #1f1f1f;
            padding: 2px 10px;
            border-radius: 30px;
            border: 1px solid #333;
        }

        .card-imdb {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #1f1f1f;
            padding: 2px 8px;
            border-radius: 30px;
            color: #dddddd;
            font-weight: 600;
            border: 1px solid #333;
        }

        .card-type {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #cccccc;
            letter-spacing: 0.4px;
            margin-top: 6px;
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            color: #666;
            font-size: 1.2rem;
        }

        /* –ù–∏–∂–Ω—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è (–º–æ–±—ñ–ª—å–Ω–∞) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #0a0a0a;
            border-top: 1px solid #2a2a2a;
            display: flex;
            justify-content: space-around;
            padding: 10px 0 20px;
            z-index: 200;
            display: none;
            backdrop-filter: blur(8px);
        }

        .bottom-nav a {
            color: #aaa;
            font-size: 1.4rem;
            transition: color 0.2s;
            cursor: pointer;
            text-align: center;
            flex: 1;
        }

        .bottom-nav a.active {
            color: #ffffff;
        }

        .bottom-nav span {
            display: block;
            font-size: 0.7rem;
            margin-top: 4px;
        }

        @media (max-width: 700px) {
            .app {
                padding: 0 16px 70px;
            }

            .header-top .search-box {
                width: 100%;
                order: 3;
            }

            .nav-links {
                display: none;
            }

            .bottom-nav {
                display: flex;
            }

            .trend-card {
                flex: 0 0 130px;
            }

            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (–ø–ª–µ—î—Ä) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            backdrop-filter: blur(12px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: #151515;
            width: 95%;
            max-width: 1000px;
            border-radius: 30px;
            border: 1px solid #333;
            overflow: hidden;
            box-shadow: 0 30px 60px rgba(255,255,255,0.1);
            transform: scale(0.95);
            animation: scaleIn 0.3s forwards;
        }

        @keyframes scaleIn {
            to {
                transform: scale(1);
            }
        }

        .modal-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #2a2a2a;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            max-width: 80%;
        }

        .close-modal {
            background: none;
            border: none;
            color: #aaa;
            font-size: 2.2rem;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            line-height: 1;
        }

        .close-modal:hover {
            color: #ffffff;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 24px;
        }

        /* –í–∫–ª–∞–¥–∫–∏ –æ–∑–≤—É—á–µ–Ω–Ω—è */
        .voiceover-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .voiceover-tab {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #ccc;
            padding: 8px 16px;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .voiceover-tab.active {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
            box-shadow: 0 0 15px rgba(255,255,255,0.3);
        }

        .voiceover-tab:hover {
            background: #2a2a2a;
            border-color: #ffffff;
            color: white;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–ª–µ—î—Ä–∞ (–ü–ª–µ—î—Ä ¬∑ –¢—Ä–µ–π–ª–µ—Ä) */
        .player-header {
            margin-bottom: 16px;
            display: flex;
            align-items: baseline;
            gap: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .player-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: #ffffff;
            letter-spacing: -0.02em;
        }

        .player-subtitle {
            font-size: 1.2rem;
            font-weight: 500;
            color: #aaaaaa;
            text-transform: uppercase;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–µ—î—Ä–∞ */
        .player-container {
            background: #1a1a1a;
            border-radius: 24px;
            aspect-ratio: 16 / 9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            border: 1px solid #333;
            margin-bottom: 20px;
            background-image: radial-gradient(circle at 30% 30%, #2a2a2a, #111);
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .player-container iframe,
        .player-container video {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 24px;
        }

        .player-fallback {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            text-align: center;
            padding: 20px;
        }

        .fallback-message {
            font-size: 1.8rem;
            font-weight: 700;
            color: #dddddd;
            text-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .fallback-info {
            font-size: 1.2rem;
            color: #cccccc;
            background: rgba(255,255,255,0.05);
            padding: 8px 20px;
            border-radius: 40px;
            border: 1px solid #444;
        }

        .play-btn {
            background: #ffffff;
            color: #000000;
            border: none;
            font-size: 1.2rem;
            font-weight: 700;
            padding: 14px 40px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: opacity 0.2s, transform 0.2s, box-shadow 0.2s;
            margin: 10px 0;
        }

        .play-btn:hover {
            opacity: 0.9;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .episode-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1f1f1f;
            padding: 12px 20px;
            border-radius: 50px;
            margin: 10px 0 20px;
            border: 1px solid #333;
            color: #cccccc;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .episode-info-bar i {
            color: #ffffff;
            margin-right: 6px;
        }

        /* –î–µ—Ç–∞–ª—ñ –∞–Ω—ñ–º–µ */
        .modal-details {
            color: #ccc;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-top: 16px;
            background: #1a1a1a;
            padding: 24px;
            border-radius: 24px;
            border: 1px solid #2a2a2a;
        }

        .sources-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .source-btn {
            background: transparent;
            border: 1px solid #555;
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .source-btn:hover {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
        }

        .watchlist-btn {
            background: transparent;
            border: 1px solid #ffffff;
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .watchlist-btn:hover {
            background: #ffffff;
            color: #000000;
        }

        .watchlist-btn.active {
            background: #ffffff;
            color: #000000;
        }

        .ukr-badge {
            display: inline-block;
            background: #1f1f1f;
            color: #dddddd;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
            border: 1px solid #444;
        }

        /* –§—É—Ç–µ—Ä */
        .footer {
            border-top: 1px solid #222;
            padding: 30px 0 40px;
            color: #777;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer a {
            color: #bbb;
            text-decoration: none;
            margin-right: 24px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: #ffffff;
        }

        /* –°—Ç–∏–ª—ñ Plyr (—Ç–µ–º–Ω–∞ —Ç–µ–º–∞) */
        .plyr {
            border-radius: 24px;
            overflow: hidden;
        }

        .plyr--video {
            background: #1a1a1a;
        }

        .plyr__control {
            color: #ffffff;
        }

        .plyr__control:hover {
            background: #ffffff;
            color: #000000;
        }

        .plyr--full-ui input[type=range] {
            color: #ffffff;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∏–±–æ—Ä—É –µ–ø—ñ–∑–æ–¥—É */
        #episodeSelector {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
        }

        #episodeSelect {
            background: #1a1a1a;
            border: 1px solid #444;
            color: white;
            padding: 8px 28px 8px 14px;
            border-radius: 30px;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2'><polyline points='6 9 12 15 18 9'/></svg>");
            background-repeat: no-repeat;
            background-position: right 8px center;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        .fa-spinner {
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
        }
    </style>
</head>
<body>
<div class="app">
    <header class="header">
        <div class="header-top">
            <div class="logo">SAYS UA ¬∑ –∞–Ω—ñ–º–µ</div>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="search" id="searchInput" placeholder="–ü–æ—à—É–∫ –∞–Ω—ñ–º–µ..." aria-label="–ü–æ—à—É–∫">
            </div>
            <div class="user-icon" id="userIcon">
                <i class="far fa-user-circle"></i>
            </div>
        </div>
        <div class="nav-links" id="navLinks">
            <a data-nav="home" class="active">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a data-nav="movies">–§—ñ–ª—å–º–∏</a>
            <a data-nav="series">–°–µ—Ä—ñ–∞–ª–∏ (TV)</a>
            <a data-nav="ova">OVA/ONA</a>
            <a data-nav="collections">–î–æ–±—ñ—Ä–∫–∏</a>
            <a data-nav="ratings">–†–µ–π—Ç–∏–Ω–≥–∏</a>
        </div>
    </header>

    <section class="trending-section" id="trendingSection">
        <div class="section-title"><i class="fas fa-fire"></i> –¢–æ–ø –∞–Ω—ñ–º–µ</div>
        <div class="trending-scroll" id="trendingScroll"></div>
    </section>

    <div class="filter-section">
        <div class="genre-chips" id="genreChips"></div>
        <div class="sort-control">
            <span><i class="fas fa-sort"></i></span>
            <select id="sortSelect">
                <option value="default">–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º</option>
                <option value="rating">–∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º</option>
                <option value="year">–∑–∞ —Ä–æ–∫–æ–º (–Ω–æ–≤—ñ—à—ñ)</option>
            </select>
        </div>
    </div>

    <main>
        <div class="movies-grid" id="moviesGrid">
            <div class="no-results">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>
    </main>

    <footer class="footer">
        <div>¬© 2025 SAYS UA ‚Äî –º–æ–Ω–æ—Ö—Ä–æ–º–Ω–∏–π –∞–Ω—ñ–º–µ-–∫–∞—Ç–∞–ª–æ–≥</div>
        <div>
            <a id="footerAbout">–ü—Ä–æ –Ω–∞—Å</a>
            <a id="footerApi">API (Jikan)</a>
            <a id="footerSupport">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</a>
        </div>
    </footer>
</div>

<div class="bottom-nav">
    <a data-nav="home" class="active"><i class="fas fa-home"></i><span>–ì–æ–ª–æ–≤–Ω–∞</span></a>
    <a data-nav="movies"><i class="fas fa-film"></i><span>–§—ñ–ª—å–º–∏</span></a>
    <a data-nav="series"><i class="fas fa-tv"></i><span>TV</span></a>
    <a data-nav="ova"><i class="fas fa-compact-disc"></i><span>OVA</span></a>
    <a data-nav="watchlist"><i class="fas fa-bookmark"></i><span>–ú–æ—î</span></a>
</div>

<div class="modal" id="videoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">–ù–∞–∑–≤–∞</h2>
            <button class="close-modal" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <!-- –í–∫–ª–∞–¥–∫–∏ –æ–∑–≤—É—á–µ–Ω–Ω—è (FanVoxUA –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó) -->
            <div class="voiceover-tabs" id="voiceoverTabs">
                <button class="voiceover-tab active" data-lang="en">–ê–Ω–≥–ª/Sub (Consumet)</button>
                <button class="voiceover-tab" data-lang="ru">–†–æ—Å—ñ–π—Å—å–∫–∞ (AniLibria)</button>
                <button class="voiceover-tab" data-lang="ua">FanVoxUA</button>
            </div>

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–ü–ª–µ—î—Ä –¢—Ä–µ–π–ª–µ—Ä" -->
            <div class="player-header">
                <span class="player-title">–ü–ª–µ—î—Ä</span>
                <span class="player-subtitle">–¢—Ä–µ–π–ª–µ—Ä</span>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–µ—î—Ä–∞ -->
            <div class="player-container" id="playerContainer">
                <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
            </div>

            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä—ñ—é (—Å–µ–∑–æ–Ω, —Å—Ç—É–¥—ñ—è, —Å–µ—Ä—ñ—è) -->
            <div class="episode-info-bar" id="episodeInfoBar">
                <span><i class="fas fa-tag"></i> <span id="seasonInfo">1 —Å–µ–∑–æ–Ω</span></span>
                <span><i class="fas fa-microphone"></i> <span id="studioInfo">FanVoxUA</span></span>
                <span><i class="fas fa-play-circle"></i> <span id="episodeInfo">1 —Å–µ—Ä—ñ—è</span></span>
            </div>

            <!-- –í–∏–±—ñ—Ä –µ–ø—ñ–∑–æ–¥—É (–¥–ª—è –±–∞–≥–∞—Ç–æ—Å–µ—Ä—ñ–π–Ω–∏—Ö) -->
            <div class="sort-control" id="episodeSelector" style="margin-top:20px; display:none;">
                <span>–ï–ø—ñ–∑–æ–¥:</span>
                <select id="episodeSelect"></select>
            </div>

            <!-- –î–µ—Ç–∞–ª—ñ –∞–Ω—ñ–º–µ -->
            <div class="modal-details" id="modalDetails">
                <p><strong>–†—ñ–∫:</strong> <span id="modalYear"></span></p>
                <p><strong>–ñ–∞–Ω—Ä–∏:</strong> <span id="modalGenres"></span></p>
                <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> <span id="modalImdb"></span>/10</p>
                <p><strong>–¢–∏–ø:</strong> <span id="modalType"></span> <span class="ukr-badge">üá∫üá¶ FanVoxUA</span></p>
                <p><strong>–°–µ—Ä—ñ–π / —Å—Ç–∞—Ç—É—Å:</strong> <span id="modalEpisodes"></span></p>
                
                <div class="sources-list" id="sourcesList">
                    <button class="source-btn" id="malSearchBtn"><i class="fab fa-my-anime-list"></i> MyAnimeList</button>
                    <button class="source-btn" id="googleSearchBtn"><i class="fab fa-google"></i> Google</button>
                    <button class="source-btn" id="trailerBtn"><i class="fab fa-youtube"></i> –¢—Ä–µ–π–ª–µ—Ä</button>
                </div>
                
                <button class="watchlist-btn" id="watchlistToggle"><i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/hls.js/latest/hls.js"></script>
<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
<script>
    (function() {
        // ========== –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ==========
        const JIKAN_BASE = 'https://api.jikan.moe/v4';
        const CONSUMET_BASE = 'https://api.consumet.org/anime/gogoanime/';
        const ANILIBRIA_BASE = 'https://anilibria.top/api/v1/';
        
        const ANIME_GENRES = [
            '–£—Å—ñ', 'Action', 'Adventure', 'Comedy', 'Drama', 'Fantasy', 
            'Horror', 'Romance', 'Sci-Fi', 'Slice of Life', 'Sports', 'Mystery'
        ];

        // –°—Ç–∞–Ω
        let activeGenre = '–£—Å—ñ';
        let currentSort = 'default';
        let activeNav = 'home';
        let searchQuery = '';
        let watchlist = JSON.parse(localStorage.getItem('saysua_anime_watchlist')) || [];
        let currentAnimeId = null;
        let currentAnimeTitle = '';
        let currentAnimeYear = '';
        let currentAnimeTrailer = null;
        let allAnimeData = [];
        let currentPlyr = null;

        // DOM
        const grid = document.getElementById('moviesGrid');
        const chipsContainer = document.getElementById('genreChips');
        const sortSelect = document.getElementById('sortSelect');
        const searchInput = document.getElementById('searchInput');
        const navLinks = document.querySelectorAll('#navLinks a, .bottom-nav a');
        const userIcon = document.getElementById('userIcon');
        const trendingScroll = document.getElementById('trendingScroll');
        const modal = document.getElementById('videoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalYear = document.getElementById('modalYear');
        const modalGenres = document.getElementById('modalGenres');
        const modalImdb = document.getElementById('modalImdb');
        const modalType = document.getElementById('modalType');
        const modalEpisodes = document.getElementById('modalEpisodes');
        const playerContainer = document.getElementById('playerContainer');
        const episodeSelector = document.getElementById('episodeSelector');
        const episodeSelect = document.getElementById('episodeSelect');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const watchlistToggle = document.getElementById('watchlistToggle');
        const malSearchBtn = document.getElementById('malSearchBtn');
        const googleSearchBtn = document.getElementById('googleSearchBtn');
        const trailerBtn = document.getElementById('trailerBtn');
        const voiceoverTabs = document.getElementById('voiceoverTabs');
        const seasonInfo = document.getElementById('seasonInfo');
        const studioInfo = document.getElementById('studioInfo');
        const episodeInfo = document.getElementById('episodeInfo');

        // ========== –§–£–ù–ö–¶–Ü–á JIKAN ==========
        async function fetchJikan(endpoint) {
            try {
                const url = `${JIKAN_BASE}${endpoint}`;
                const response = await fetch(url);
                const data = await response.json();
                return data.data || [];
            } catch (error) {
                console.error('Jikan error:', error);
                return [];
            }
        }

        async function fetchTopAnime(type = '', page = 1) {
            let endpoint = `/top/anime?page=${page}`;
            if (type) endpoint += `&type=${type}`;
            return await fetchJikan(endpoint);
        }

        async function searchAnime(query) {
            if (!query) return [];
            const endpoint = `/anime?q=${encodeURIComponent(query)}&order_by=score&sort=desc`;
            return await fetchJikan(endpoint);
        }

        async function fetchAnimeDetails(id) {
            const endpoint = `/anime/${id}`;
            try {
                const url = `${JIKAN_BASE}${endpoint}`;
                const response = await fetch(url);
                const data = await response.json();
                return data.data || null;
            } catch (error) {
                console.error('Details error:', error);
                return null;
            }
        }

        // ========== CONSUMET (Gogoanime) ==========
        async function getStreamingId(title) {
            try {
                const res = await fetch(`${CONSUMET_BASE}${encodeURIComponent(title)}`);
                const data = await res.json();
                if (data.results && data.results.length) {
                    return data.results[0].id;
                }
                return null;
            } catch (error) {
                console.error('Consumet search error:', error);
                return null;
            }
        }

        async function getEpisodes(streamId) {
            try {
                const res = await fetch(`${CONSUMET_BASE}info/${streamId}`);
                const data = await res.json();
                return data.episodes || [];
            } catch (error) {
                console.error('Consumet info error:', error);
                return [];
            }
        }

        async function getStream(episodeId) {
            try {
                const res = await fetch(`${CONSUMET_BASE}watch/${episodeId}`);
                const data = await res.json();
                if (data.sources && data.sources.length) {
                    return data.sources.find(s => s.quality === '1080p' || s.quality === '720p' || s.quality === 'default') || data.sources[0];
                }
                return null;
            } catch (error) {
                console.error('Consumet watch error:', error);
                return null;
            }
        }

        // ========== ANILIBRIA ==========
        async function getAniLibriaId(title) {
            try {
                const res = await fetch(`${ANILIBRIA_BASE}title/search?search=${encodeURIComponent(title)}`);
                const data = await res.json();
                if (data && data.length > 0) {
                    return data[0].code || data[0].id;
                }
                return null;
            } catch (error) {
                console.error('AniLibria search error:', error);
                return null;
            }
        }

        async function getAniLibriaEpisodes(code) {
            try {
                const res = await fetch(`${ANILIBRIA_BASE}title?code=${code}&filter=player.playlist`);
                const data = await res.json();
                return data.player?.playlist || [];
            } catch (error) {
                console.error('AniLibria details error:', error);
                return [];
            }
        }

        // ========== –†–ï–ù–î–ï–† –ö–ê–†–¢–û–ö ==========
        function renderMovies(animeArray) {
            allAnimeData = animeArray;

            if (!animeArray.length) {
                grid.innerHTML = `<div class="no-results">üòï –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>`;
                return;
            }

            let html = '';
            animeArray.forEach(a => {
                const title = a.title_ukrainian || a.title || a.title_english || '–ë–µ–∑ –Ω–∞–∑–≤–∏';
                const year = a.aired?.prop?.from?.year || a.aired?.from?.split('-')[0] || '‚Äî';
                const score = a.score ? a.score.toFixed(1) : '?';
                const type = a.type || 'ANIME';
                const posterUrl = a.images?.jpg?.image_url || '';
                const id = a.mal_id;
                const inWatchlist = watchlist.includes(id) ? 'fa-solid' : 'fa-regular';

                html += `
                    <div class="movie-card" data-id="${id}" data-type="${type}" data-title="${title}" data-year="${year}">
                        <div class="card-poster" style="${posterUrl ? `background-image: url('${posterUrl}')` : ''}">
                            ${!posterUrl ? `<span>${title.slice(0,2)}</span>` : ''}
                            <div class="watchlist-badge"><i class="${inWatchlist} fa-bookmark"></i></div>
                        </div>
                        <div class="card-info">
                            <div class="card-title">${title}</div>
                            <div class="card-meta">
                                <span class="card-year">${year}</span>
                                <span class="card-imdb"><i class="fas fa-star"></i> ${score}</span>
                            </div>
                            <div class="card-type">${type} ¬∑ ${a.episodes ? a.episodes + ' —Å–µ—Ä.' : '?'}</div>
                        </div>
                    </div>
                `;
            });
            grid.innerHTML = html;

            document.querySelectorAll('.movie-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = parseInt(card.dataset.id);
                    const type = card.dataset.type;
                    const title = card.dataset.title;
                    const year = card.dataset.year;
                    openModal(id, type, title, year);
                });
            });
        }

        async function openModal(id, type, title, year) {
            currentAnimeId = id;
            currentAnimeTitle = title;
            currentAnimeYear = year;

            const details = await fetchAnimeDetails(id);
            if (!details) {
                alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ');
                return;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—Ä–µ–π–ª–µ—Ä
            currentAnimeTrailer = details.trailer?.embed_url || null;

            modalTitle.textContent = details.title_ukrainian || details.title || details.title_english;
            modalYear.textContent = details.aired?.prop?.from?.year || details.aired?.from?.split('-')[0] || year;
            modalGenres.textContent = details.genres?.map(g => g.name).join(', ') || '‚Äî';
            modalImdb.textContent = details.score?.toFixed(1) || '?';
            modalType.textContent = details.type || '–ê–Ω—ñ–º–µ';
            modalEpisodes.textContent = `${details.episodes || '?'} —Å–µ—Ä—ñ–π, —Å—Ç–∞—Ç—É—Å: ${details.status || '‚Äî'}`;

            // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ—Ä—ñ—é
            seasonInfo.textContent = '1 —Å–µ–∑–æ–Ω'; // –ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø—ñ–¥ —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
            studioInfo.textContent = 'FanVoxUA';
            episodeInfo.textContent = '1 —Å–µ—Ä—ñ—è';

            // –ö–Ω–æ–ø–∫–∏
            malSearchBtn.onclick = () => window.open(`https://myanimelist.net/anime/${id}`, '_blank');
            googleSearchBtn.onclick = () => window.open(`https://www.google.com/search?q=${encodeURIComponent(title + ' –∞–Ω—ñ–º–µ –¥–∏–≤–∏—Ç–∏—Å—è –æ–Ω–ª–∞–π–Ω')}`, '_blank');
            trailerBtn.onclick = () => {
                if (currentAnimeTrailer) {
                    window.open(currentAnimeTrailer, '_blank');
                } else {
                    alert('–¢—Ä–µ–π–ª–µ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }
            };

            // –í–∫–ª–∞–¥–∫–∏ –æ–∑–≤—É—á–µ–Ω–Ω—è (–≤–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏)
            const tabButtons = voiceoverTabs.querySelectorAll('.voiceover-tab');
            tabButtons.forEach(btn => {
                btn.replaceWith(btn.cloneNode(true)); // —Å–∫–∏–¥–∞—î–º–æ –≤—Å—ñ –ø–æ–¥—ñ—ó
            });
            // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–æ–≤—ñ –∫–Ω–æ–ø–∫–∏
            const newTabButtons = voiceoverTabs.querySelectorAll('.voiceover-tab');
            newTabButtons.forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    newTabButtons.forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    await loadPlayer(e.target.dataset.lang, details);
                });
            });

            // –ü–æ—á–∞—Ç–∫–æ–≤–æ –∞–∫—Ç–∏–≤–Ω–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞
            newTabButtons[0]?.classList.add('active');
            await loadPlayer('en', details);

            if (watchlist.includes(id)) {
                watchlistToggle.innerHTML = '<i class="fas fa-bookmark"></i> –£ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.add('active');
            } else {
                watchlistToggle.innerHTML = '<i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.remove('active');
            }

            modal.classList.add('active');
        }

        async function loadPlayer(lang, details) {
            if (currentPlyr) {
                currentPlyr.destroy();
                currentPlyr = null;
            }
            playerContainer.innerHTML = `<i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #666;"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–ª–µ—î—Ä–∞...`;
            episodeSelector.style.display = 'none';

            if (lang === 'en') {
                const streamId = await getStreamingId(details.title_english || details.title || currentAnimeTitle);
                const episodes = await getEpisodes(streamId);

                if (streamId && episodes.length) {
                    playerContainer.innerHTML = `<video id="player" controls playsinline poster="${details.images?.jpg?.large_image_url || ''}"></video>`;
                    currentPlyr = new Plyr('#player', {
                        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
                        settings: ['captions', 'quality', 'speed'],
                        quality: { default: 'default', options: ['1080p', '720p', '480p', '360p', 'default'] }
                    });

                    episodeSelector.style.display = episodes.length > 1 ? 'flex' : 'none';
                    if (episodes.length > 1) {
                        episodeSelect.innerHTML = episodes.map(ep => `<option value="${ep.id}">${ep.title || `–ï–ø—ñ–∑–æ–¥ ${ep.number}`}</option>`).join('');
                        episodeSelect.onchange = async (e) => {
                            await loadStream(e.target.value, 'en');
                        };
                    }

                    await loadStream(episodes[0].id, 'en');
                } else {
                    showFallback('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Å—Ç—Ä—ñ–º—ñ–≤ –Ω–∞ Consumet');
                }
            } else if (lang === 'ru') {
                const code = await getAniLibriaId(details.title_english || details.title || currentAnimeTitle);
                const episodes = await getAniLibriaEpisodes(code);

                if (code && episodes.length) {
                    playerContainer.innerHTML = `<video id="player" controls playsinline poster="${details.images?.jpg?.large_image_url || ''}"></video>`;
                    currentPlyr = new Plyr('#player', {
                        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
                        settings: ['captions', 'quality', 'speed'],
                        quality: { default: 'default', options: ['1080p', '720p', '480p', '360p', 'default'] }
                    });

                    episodeSelector.style.display = episodes.length > 1 ? 'flex' : 'none';
                    if (episodes.length > 1) {
                        episodeSelect.innerHTML = episodes.map((ep, index) => `<option value="${index}">${ep.name || `–ï–ø—ñ–∑–æ–¥ ${index + 1}`}</option>`).join('');
                        episodeSelect.onchange = async (e) => {
                            await loadStream(e.target.value, 'ru', episodes);
                        };
                    }

                    await loadStream(0, 'ru', episodes);
                } else {
                    showFallback('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ AniLibria');
                }
            } else if (lang === 'ua') {
                // FanVoxUA ‚Äì –ø–æ—à—É–∫ —É Google –∑ —É—Ç–æ—á–Ω–µ–Ω–Ω—è–º
                playerContainer.innerHTML = `
                    <div class="player-fallback">
                        <div class="fallback-message">–í—ñ–¥–µ–æ –Ω–µ –ø—Ä–∞—Ü—é—î?</div>
                        <div class="fallback-info">1 —Å–µ–∑–æ–Ω FanVoxUA 1 —Å–µ—Ä—ñ—è</div>
                        <button class="play-btn" id="playDefaultBtn"><i class="fas fa-play"></i> –®—É–∫–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é</button>
                    </div>
                `;
                document.getElementById('playDefaultBtn').onclick = () => {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(currentAnimeTitle + ' –∞–Ω—ñ–º–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –æ–∑–≤—É—á–∫–æ—é FanVoxUA –¥–∏–≤–∏—Ç–∏—Å—è –æ–Ω–ª–∞–π–Ω')}`, '_blank');
                };
            }
        }

        async function loadStream(id, lang, episodes = null) {
            const video = document.getElementById('player');
            if (!video) return;
            let streamUrl;

            if (lang === 'en') {
                const stream = await getStream(id);
                if (stream) streamUrl = stream.url;
            } else if (lang === 'ru') {
                const ep = episodes[id];
                streamUrl = ep.file || ep.hd || ep.sd || ep.hls || ep.player;
                if (streamUrl && streamUrl.startsWith('//')) {
                    streamUrl = 'https:' + streamUrl;
                }
            }

            if (streamUrl) {
                video.src = streamUrl;
                if (streamUrl.endsWith('.m3u8')) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(streamUrl);
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.play();
                    }
                } else {
                    video.play();
                }
            } else {
                alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç—Ä—ñ–º');
            }
        }

        function showFallback(message) {
            playerContainer.innerHTML = `
                <div class="player-fallback">
                    <div class="fallback-message">–í—ñ–¥–µ–æ –Ω–µ –ø—Ä–∞—Ü—é—î?</div>
                    <div class="fallback-info">1 —Å–µ–∑–æ–Ω FanVoxUA 1 —Å–µ—Ä—ñ—è</div>
                    <button class="play-btn" id="playDefaultBtn"><i class="fas fa-play"></i> –®—É–∫–∞—Ç–∏ –≤ Google</button>
                </div>
            `;
            document.getElementById('playDefaultBtn').onclick = () => {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(currentAnimeTitle + ' –∞–Ω—ñ–º–µ –¥–∏–≤–∏—Ç–∏—Å—è –æ–Ω–ª–∞–π–Ω –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º')}`, '_blank');
            };
        }

        async function loadHome() {
            const topAnime = await fetchTopAnime('', 1);
            renderMovies(topAnime);

            let trendHtml = '';
            topAnime.slice(0, 10).forEach(a => {
                trendHtml += `
                    <div class="trend-card" data-id="${a.mal_id}" data-type="${a.type}" data-title="${a.title}" data-year="${a.aired?.prop?.from?.year || ''}">
                        <div class="trend-poster"><span>${(a.title || '??').slice(0,2)}</span></div>
                        <div class="trend-info">
                            <h4>${a.title}</h4>
                            <div class="trend-meta" style="color:#aaa;"><i class="fas fa-star"></i> ${a.score?.toFixed(1) || '?'}</div>
                        </div>
                    </div>
                `;
            });
            trendingScroll.innerHTML = trendHtml;
            document.querySelectorAll('.trend-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = parseInt(card.dataset.id);
                    const type = card.dataset.type;
                    const title = card.dataset.title;
                    const year = card.dataset.year;
                    openModal(id, type, title, year);
                });
            });

            renderChips();
        }

        async function loadByType(type) {
            let animeType = '';
            if (type === 'movies') animeType = 'movie';
            else if (type === 'series') animeType = 'tv';
            else if (type === 'ova') animeType = 'ova';
            
            const data = await fetchTopAnime(animeType, 1);
            renderMovies(data);
        }

        function renderChips() {
            chipsContainer.innerHTML = '';
            ANIME_GENRES.forEach(genre => {
                const chip = document.createElement('span');
                chip.className = `chip ${activeGenre === genre ? 'active' : ''}`;
                chip.textContent = genre;
                chip.dataset.genre = genre;
                chip.addEventListener('click', () => {
                    activeGenre = genre;
                    renderChips();
                    if (genre === '–£—Å—ñ') loadHome();
                    else searchByGenre(genre);
                });
                chipsContainer.appendChild(chip);
            });
        }

        async function searchByGenre(genre) {
            const endpoint = `/anime?genres=${getGenreId(genre)}&order_by=score&sort=desc`;
            const data = await fetchJikan(endpoint);
            renderMovies(data);
        }

        function getGenreId(genreName) {
            const map = {
                'Action': 1, 'Adventure': 2, 'Comedy': 4, 'Drama': 8, 'Fantasy': 10,
                'Horror': 14, 'Romance': 22, 'Sci-Fi': 24, 'Slice of Life': 36, 'Sports': 30, 'Mystery': 7
            };
            return map[genreName] || '';
        }

        function applySort() {
            if (!allAnimeData.length) return;
            let sorted = [...allAnimeData];
            if (currentSort === 'rating') {
                sorted.sort((a, b) => (b.score || 0) - (a.score || 0));
            } else if (currentSort === 'year') {
                sorted.sort((a, b) => {
                    const ay = a.aired?.prop?.from?.year || a.aired?.from?.split('-')[0] || 0;
                    const by = b.aired?.prop?.from?.year || b.aired?.from?.split('-')[0] || 0;
                    return by - ay;
                });
            }
            renderMovies(sorted);
        }

        function setActiveNav(targetNav) {
            navLinks.forEach(link => {
                if (link.dataset.nav === targetNav) link.classList.add('active');
                else link.classList.remove('active');
            });
            activeNav = targetNav;

            if (targetNav === 'home') loadHome();
            else if (targetNav === 'movies' || targetNav === 'series' || targetNav === 'ova' || targetNav === 'collections' || targetNav === 'ratings') {
                loadByType(targetNav);
            } else if (targetNav === 'watchlist') showWatchlist();
        }

        function showWatchlist() {
            if (watchlist.length === 0) {
                grid.innerHTML = `<div class="no-results">–°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–æ—Ä–æ–∂–Ω—ñ–π</div>`;
                return;
            }
            Promise.all(watchlist.slice(0, 20).map(id => fetchAnimeDetails(id)))
                .then(results => renderMovies(results.filter(r => r !== null)));
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        loadHome();

        searchInput.addEventListener('input', (e) => {
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(async () => {
                const query = e.target.value.trim();
                if (query.length > 2) {
                    const results = await searchAnime(query);
                    renderMovies(results);
                } else if (query.length === 0) {
                    loadHome();
                }
            }, 500);
        });

        sortSelect.addEventListener('change', (e) => {
            currentSort = e.target.value;
            applySort();
        });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveNav(link.dataset.nav);
            });
        });

        userIcon.addEventListener('click', () => alert('üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∫–∞–±—ñ–Ω–µ—Ç (–¥–µ–º–æ)'));

        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('active');
            if (currentPlyr) currentPlyr.destroy();
        });
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                if (currentPlyr) currentPlyr.destroy();
            }
        });

        watchlistToggle.addEventListener('click', () => {
            if (!currentAnimeId) return;
            const idx = watchlist.indexOf(currentAnimeId);
            if (idx === -1) {
                watchlist.push(currentAnimeId);
                watchlistToggle.innerHTML = '<i class="fas fa-bookmark"></i> –£ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.add('active');
            } else {
                watchlist.splice(idx, 1);
                watchlistToggle.innerHTML = '<i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.remove('active');
            }
            localStorage.setItem('saysua_anime_watchlist', JSON.stringify(watchlist));
        });

        document.getElementById('footerAbout').addEventListener('click', () => alert('–°–∞–π—Ç –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –∞–Ω—ñ–º–µ –≤ –º–æ–Ω–æ—Ö—Ä–æ–º–Ω–æ–º—É —Å—Ç–∏–ª—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Jikan API —Ç–∞ Consumet –¥–ª—è —Å—Ç—Ä—ñ–º—ñ–≤.'));
        document.getElementById('footerApi').addEventListener('click', () => window.open('https://jikan.moe/', '_blank'));
        document.getElementById('footerSupport').addEventListener('click', () => alert('–ü—ñ–¥—Ç—Ä–∏–º–∫–∞: example@email.com'));

        setActiveNav('home');
    })();
</script>
</body>
</html>
