<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>
  <title>FANTASYAS TV ¬∑ –Ø—Å–∫—Ä–∞–≤–∏–π –æ—Ä–∞–Ω–∂–µ–≤–∏–π</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    /* ========== –ì–õ–û–ë–ê–õ–¨–ù–Ü –°–¢–ò–õ–Ü ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Manrope', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --bg: #0f0f0f;
      --surface: #1d1d1d;
      --surface-variant: #2a2a2a;
      --border: #3a3a3a;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --text-tertiary: #6c6c70;
      --accent: #ff6b00;          /* –Ø—Å–∫—Ä–∞–≤–∏–π –æ—Ä–∞–Ω–∂–µ–≤–∏–π */
      --accent-hover: #ff8c33;
      --danger: #cf6679;
      --success: #4caf50;
      --warning: #f5a623;
      --shadow-sm: 0 4px 8px rgba(0,0,0,0.6);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.8);
      --shadow-lg: 0 12px 32px rgba(0,0,0,0.9);
      --radius-sm: 16px;
      --radius-md: 24px;
      --radius-lg: 32px;
      --sidebar-width: 350px;
      --header-height: 80px;
    }

    body {
      background: var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      font-size: 18px;
      line-height: 1.5;
      font-weight: 600;           /* –∂–∏—Ä–Ω–∏–π –±–∞–∑–æ–≤–∏–π —à—Ä–∏—Ñ—Ç */
    }

    /* –ñ–∏—Ä–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ */
    h1, h2, h3, h4, .logo, .top-bar-title, .nav-item, .btn {
      font-weight: 800;
    }

    /* –§–æ–∫—É—Å–Ω–∏–π —Å—Ç–∞–Ω (–ø—É–ª—å—Ç) */
    .focused {
      transform: scale(1.05);
      box-shadow: 0 0 0 4px var(--bg), 0 0 0 8px var(--accent);
      background-color: var(--surface-variant);
      z-index: 10;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background-color 0.1s;
      outline: none;
    }

    /* –°—Ç—Ä—ñ–ª–æ—á–∫–∞-–∫—É—Ä—Å–æ—Ä */
    #tvCursor {
      position: fixed;
      width: 48px;
      height: 48px;
      background: transparent;
      display: none;
      z-index: 10000;
      pointer-events: none;
      transition: all 0.15s ease;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,0.5));
      color: var(--accent);
    }
    #tvCursor svg {
      width: 100%;
      height: 100%;
      fill: currentColor;
      stroke: white;
      stroke-width: 1.5;
    }

    /* –ë–æ–∫–æ–≤–µ –º–µ–Ω—é */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 20px 0;
      overflow-y: auto;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 0 24px 24px;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      font-size: 2.4rem;
      letter-spacing: -0.5px;
      color: var(--accent);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 18px 24px;
      margin: 8px 16px;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 1.4rem;
      cursor: pointer;
    }
    .nav-item.active {
      background: var(--accent);
      color: var(--bg);
    }
    .nav-item .icon {
      width: 32px;
      height: 32px;
      stroke: currentColor;
      stroke-width: 1.8;
      fill: none;
    }
    .nav-item .badge {
      margin-left: auto;
      background: var(--accent);
      color: var(--bg);
      padding: 4px 12px;
      border-radius: 40px;
      font-size: 1rem;
    }

    /* –ì–æ–ª–æ–≤–Ω–∞ –æ–±–ª–∞—Å—Ç—å */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg);
    }

    .top-bar {
      height: var(--header-height);
      background: rgba(15,15,15,0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 32px;
      gap: 24px;
    }

    .menu-toggle {
      display: none;
      width: 40px;
      height: 30px;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
    }
    .menu-toggle span {
      height: 4px;
      width: 100%;
      background: var(--text-primary);
      border-radius: 4px;
    }

    .top-bar-title {
      font-size: 2.2rem;
      font-weight: 800;
      flex: 1;
    }

    /* –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ */
    .lang-switcher {
      display: flex;
      gap: 12px;
    }
    .lang-btn {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-secondary);
      font-size: 1.2rem;
      font-weight: 800;
      padding: 8px 16px;
      border-radius: 40px;
      cursor: pointer;
    }
    .lang-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg);
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
      scroll-behavior: smooth;
    }

    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    /* –°—ñ—Ç–∫–∞ –¥–ª—è –ø–æ—Å—Ç—ñ–≤ (–∑–∞–º—ñ—Å—Ç—å —Å—Ç—Ä—ñ—á–∫–∏) */
    .feed {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 32px;
      padding: 20px 0;
    }

    .card, .post {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow-sm);
    }

    .post {
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .post-content {
      font-size: 1.2rem;
      line-height: 1.5;
      margin-bottom: 20px;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      font-weight: 600;
    }

    .post-author {
      font-size: 1.2rem;
      font-weight: 800;
      cursor: pointer;
    }
    .post-meta {
      font-size: 1rem;
      color: var(--text-tertiary);
    }

    /* –Ü–Ω–ø—É—Ç–∏ (–≤–µ–ª–∏–∫—ñ) */
    .input {
      width: 100%;
      padding: 18px 22px;
      border-radius: var(--radius-md);
      border: 2px solid transparent;
      background: var(--surface-variant);
      color: var(--text-primary);
      font-size: 1.3rem;
      font-weight: 600;
      outline: none;
    }
    .input.focused {
      border-color: var(--accent);
      background: var(--surface);
      transform: scale(1.02);
      box-shadow: var(--shadow-md);
    }

    .btn {
      padding: 16px 28px;
      border-radius: var(--radius-md);
      background: var(--surface-variant);
      border: none;
      color: var(--text-primary);
      font-size: 1.2rem;
      font-weight: 800;
      cursor: pointer;
      transition: background 0.1s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-primary {
      background: var(--accent);
      color: var(--bg);
    }
    .btn-primary.focused {
      background: var(--accent-hover);
    }

    /* –°–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤ */
    .chat-item {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 18px;
      border-radius: var(--radius-md);
      background: var(--surface);
      border: 1px solid var(--border);
      margin-bottom: 12px;
      cursor: pointer;
    }
    .chat-item.focused {
      background: var(--surface-variant);
      transform: scale(1.02);
      box-shadow: 0 0 0 4px var(--accent);
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--border);
    }
    .avatar.small { width: 48px; height: 48px; }
    .avatar.large { width: 96px; height: 96px; }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        transform: translateX(-100%);
      }
      .sidebar.open { transform: translateX(0); }
      .menu-toggle { display: flex; }
      .feed { grid-template-columns: 1fr; }
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 32px;
      max-width: 600px;
      width: 90%;
    }

    /* –Ü–Ω—à—ñ –¥—Ä—ñ–±–Ω—ñ —Å—Ç–∏–ª—ñ (–∑–±–µ—Ä–µ–∂–µ–Ω–æ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É, –∞–¥–∞–ø—Ç–æ–≤–∞–Ω–æ) */
    .file-input-button { background: var(--surface-variant); border: 2px dashed var(--border); padding: 16px; border-radius: var(--radius-md); text-align: center; }
    .hashtag-item { background: var(--surface); padding: 16px; border-radius: var(--radius-md); }
    .online-indicator { background: var(--success); width: 16px; height: 16px; border-radius: 50%; display: inline-block; margin-left: 8px; }
    #toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: var(--accent); color: var(--bg); padding: 16px 32px; border-radius: 40px;
      font-weight: 800; box-shadow: var(--shadow-lg); z-index: 3000; opacity: 0; transition: opacity 0.3s;
    }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>
<div class="app">
  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">FANTASYAS</div>
    </div>
    <nav class="nav">
      <div class="nav-item active" data-section="home" tabindex="0" data-i18n="navHome">
        <svg class="icon" viewBox="0 0 24 24"><path d="M3 10l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        –ì–æ–ª–æ–≤–Ω–∞
      </div>
      <div class="nav-item" data-section="search" tabindex="0" data-i18n="navSearch">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        –ü–æ—à—É–∫
      </div>
      <div class="nav-item" data-section="hashtags" tabindex="0" data-i18n="navHashtags">
        <svg class="icon" viewBox="0 0 24 24"><path d="M4 9h16M4 15h16M10 3L8 21M16 3l-2 18"/></svg>
        –•–µ—à—Ç–µ–≥–∏
      </div>
      <div class="nav-item" data-section="profile" tabindex="0" data-i18n="navProfile">
        <svg class="icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        –ü—Ä–æ—Ñ—ñ–ª—å
      </div>
      <div class="nav-item" data-section="chats" tabindex="0" data-i18n="navChats">
        <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        –ß–∞—Ç–∏
        <span class="badge" id="unreadBadge" style="display:none;">0</span>
      </div>
      <div class="nav-item" data-section="settings" tabindex="0" data-i18n="navSettings">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H5.78a1.65 1.65 0 0 0-1.51 1 1.65 1.65 0 0 0 .33 1.82l.07.07A10 10 0 0 0 12 17.66a10 10 0 0 0 6.26-2.26z"/></svg>
        –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
      </div>
    </nav>
  </aside>

  <main class="main">
    <div class="top-bar">
      <div class="menu-toggle" id="menuToggle">
        <span></span><span></span><span></span>
      </div>
      <div class="top-bar-title" id="pageTitle">–ì–æ–ª–æ–≤–Ω–∞</div>
      <div class="lang-switcher">
        <button class="lang-btn" data-lang="uk" id="lang-uk">üá∫üá¶ –£–∫—Ä</button>
        <button class="lang-btn" data-lang="ru" id="lang-ru">üá∑üá∫ –†—É—Å</button>
        <button class="lang-btn" data-lang="en" id="lang-en">üá¨üáß Eng</button>
      </div>
    </div>

    <div class="content" id="content">
      <!-- –ì–æ–ª–æ–≤–Ω–∞ -->
      <div id="home" class="section active">
        <div class="card" id="authBox">
          <div id="loginForm">
            <input type="text" id="loginNickname" class="input" placeholder="–ü—Å–µ–≤–¥–æ–Ω—ñ–º (–±–µ–∑ @)" autocomplete="off" tabindex="0" data-i18n-placeholder="loginPlaceholder"/>
            <input type="password" id="loginPassword" class="input" placeholder="–ü–∞—Ä–æ–ª—å" tabindex="0" data-i18n-placeholder="passwordPlaceholder"/>
            <button class="btn btn-primary" id="loginBtn" style="width:100%; margin-top:12px;" tabindex="0" data-i18n="loginBtn">–£–≤—ñ–π—Ç–∏</button>
            <div style="display:flex; gap:10px; margin-top:15px;">
              <button class="btn" id="googleLoginBtn" style="flex:1;" tabindex="0" data-i18n="googleBtn">Google</button>
              <button class="btn" id="appleLoginBtn" style="flex:1;" tabindex="0" data-i18n="appleBtn">Apple</button>
            </div>
            <p style="margin-top:18px;"><span data-i18n="noAccount">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç–∞?</span> <span id="toRegister" style="color:var(--accent);cursor:pointer;" tabindex="0" data-i18n="registerLink">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</span></p>
            <p><a href="#" id="forgotPassword" style="color:var(--accent);" tabindex="0" data-i18n="forgotPassword">–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a></p>
          </div>
          <div id="registerForm" style="display:none;">
            <input type="text" id="registerNickname" class="input" placeholder="–ü—Å–µ–≤–¥–æ–Ω—ñ–º (–±–µ–∑ @)" tabindex="0" data-i18n-placeholder="loginPlaceholder"/>
            <input type="password" id="registerPassword" class="input" placeholder="–ü–∞—Ä–æ–ª—å" tabindex="0" data-i18n-placeholder="passwordPlaceholder"/>
            <button class="btn btn-primary" id="registerBtn" style="width:100%; margin-top:12px;" tabindex="0" data-i18n="registerBtn">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
            <p style="margin-top:18px;"><span data-i18n="haveAccount">–í–∂–µ —î –∞–∫–∞—É–Ω—Ç?</span> <span id="toLogin" style="color:var(--accent);cursor:pointer;" tabindex="0" data-i18n="loginLink">–£–≤—ñ–π—Ç–∏</span></p>
          </div>
        </div>

        <div class="card" id="newPostBox" style="display:none;">
          <textarea id="postText" class="input" placeholder="–©–æ –Ω–æ–≤–æ–≥–æ? #—Ö–µ—à—Ç–µ–≥" rows="3" tabindex="0" data-i18n-placeholder="newPostPlaceholder"></textarea>
          <div class="file-input-wrapper" style="margin:16px 0;">
            <input type="file" id="postMedia" accept="image/*,video/*">
            <div class="file-input-button" id="postMediaLabel" data-i18n="chooseMedia">–û–±—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ</div>
          </div>
          <img id="postMediaPreview" class="file-preview" style="display:none; max-width:100%; margin-top:8px;" />
          <button class="btn btn-primary" id="addPost" style="margin-top:12px;" tabindex="0" data-i18n="publishBtn">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
        </div>

        <div class="feed-header" style="display:flex; gap:10px; margin-bottom:20px;">
          <button class="btn" id="feedNewBtn" tabindex="0" data-i18n="newBtn">–ù–æ–≤—ñ</button>
          <button class="btn" id="feedPopularBtn" tabindex="0" data-i18n="popularBtn">–ü–æ–ø—É–ª—è—Ä–Ω—ñ</button>
        </div>

        <div class="feed" id="feed"></div>
        <div class="feed-end-sentinel" id="feedSentinel"></div>
      </div>

      <!-- –Ü–Ω—à—ñ —Å–µ–∫—Ü—ñ—ó (—Å–∫–æ—Ä–æ—á–µ–Ω–æ –¥–ª—è –ª–∞–∫–æ–Ω—ñ—á–Ω–æ—Å—Ç—ñ, –∞–ª–µ –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—ñ –≤–æ–Ω–∏ –ø–æ–≤–Ω—ñ) -->
      <div id="search" class="section">
        <input type="text" id="searchInput" class="input" placeholder="–ü–æ—à—É–∫ –∑–∞ @id, —ñ–º'—è–º –∞–±–æ #—Ö–µ—à—Ç–µ–≥–æ–º..." tabindex="0" data-i18n-placeholder="searchPlaceholder"/>
        <div class="user-list" id="userList" style="margin-top:20px;"></div>
      </div>

      <div id="hashtags" class="section">
        <h2 data-i18n="popularHashtags">–ü–æ–ø—É–ª—è—Ä–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏</h2>
        <div class="hashtag-list" id="hashtagList"></div>
      </div>

      <div id="profile" class="section">
        <div class="profile-header" id="profileHeader"></div>
        <div class="profile-tabs" id="profileTabs"></div>
        <div class="feed" id="profileFeed"></div>
      </div>

      <div id="chats" class="section">
        <div class="chat-search-container">
          <input type="text" id="chatSearchInput" class="input" placeholder="–ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤..." tabindex="0" data-i18n-placeholder="searchUsersPlaceholder">
          <div id="chatSearchResults" class="user-list" style="margin-top:10px; display:none;"></div>
        </div>
        <div class="chat-list" id="chatList"></div>
        <div class="chat-window" id="chatWindow" style="display:none;">
          <div class="chat-header">
            <div class="avatar" id="chatAvatar"></div>
            <div>
              <div id="chatName"></div>
              <div class="chat-meta" id="chatUserId"></div>
            </div>
            <span id="onlineIndicator" class="online-indicator" style="display:none;"></span>
          </div>
          <div class="chat-messages" id="chatMessages" style="height:300px; overflow-y:auto;"></div>
          <div class="chat-input-area" style="display:flex; gap:8px; margin-top:12px;">
            <input type="text" id="chatText" class="input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." tabindex="0" data-i18n-placeholder="messagePlaceholder"/>
            <button class="btn btn-primary btn-icon" id="sendMessage" tabindex="0" data-i18n="sendBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
          </div>
        </div>
      </div>

      <div id="settings" class="section card">
        <h2 data-i18n="settingsTitle">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
        <button class="btn" id="toggleTheme" style="margin:18px 0;" tabindex="0" data-i18n="themeBtn">–¢–µ–º–∞</button>
        <button class="btn" id="privacyPolicyBtn" style="margin:18px 0;" tabindex="0" data-i18n="privacyBtn">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</button>
        <button class="btn" id="logoutBtn" style="margin-top:20px;" tabindex="0" data-i18n="logoutBtn">–í–∏–π—Ç–∏</button>
      </div>
    </div>
  </main>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∏ (—Å–∫–æ—Ä–æ—á–µ–Ω–æ) -->
<div class="modal" id="privacyPolicyModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 data-i18n="privacyTitle">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</h3>
      <span class="modal-close" id="closePrivacyModal" tabindex="0">&times;</span>
    </div>
    <div style="max-height: 60vh; overflow-y: auto;">
      <p data-i18n="privacyText1">–¢–µ–∫—Å—Ç –ø–æ–ª—ñ—Ç–∏–∫–∏...</p>
    </div>
  </div>
</div>

<div id="toast"></div>
<div id="tvCursor">
  <svg viewBox="0 0 32 32">
    <polygon points="2,2 30,16 2,30 8,16 2,2" fill="currentColor" stroke="white" stroke-width="2"/>
  </svg>
</div>

<script type="module">
  // ================= Firebase —ñ–º–ø–æ—Ä—Ç–∏ =================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, OAuthProvider, signInWithPopup, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, onSnapshot, orderBy, serverTimestamp, arrayUnion, arrayRemove, deleteDoc, getDocs, increment, limit, startAfter } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";

  // ================= –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è =================
  const firebaseConfig = {
    apiKey: "AIzaSyDRzC-QDE0-UXd-XL0i3iqayFiKcc6wmvc",
    authDomain: "fantasyasapp.firebaseapp.com",
    projectId: "fantasyasapp",
    storageBucket: "fantasyasapp.appspot.com",
    messagingSenderId: "721763921060",
    appId: "1:721763921060:web:3d61044ea2424e8176ca31"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // ================= –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è =================
  const i18n = {
    uk: {
      navHome: '–ì–æ–ª–æ–≤–Ω–∞',
      navSearch: '–ü–æ—à—É–∫',
      navHashtags: '–•–µ—à—Ç–µ–≥–∏',
      navProfile: '–ü—Ä–æ—Ñ—ñ–ª—å',
      navChats: '–ß–∞—Ç–∏',
      navSettings: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è',
      loginPlaceholder: '–ü—Å–µ–≤–¥–æ–Ω—ñ–º (–±–µ–∑ @)',
      passwordPlaceholder: '–ü–∞—Ä–æ–ª—å',
      loginBtn: '–£–≤—ñ–π—Ç–∏',
      googleBtn: 'Google',
      appleBtn: 'Apple',
      noAccount: '–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç–∞?',
      registerLink: '–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è',
      forgotPassword: '–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?',
      registerBtn: '–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è',
      haveAccount: '–í–∂–µ —î –∞–∫–∞—É–Ω—Ç?',
      loginLink: '–£–≤—ñ–π—Ç–∏',
      newPostPlaceholder: '–©–æ –Ω–æ–≤–æ–≥–æ? #—Ö–µ—à—Ç–µ–≥',
      chooseMedia: '–û–±—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ',
      publishBtn: '–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏',
      newBtn: '–ù–æ–≤—ñ',
      popularBtn: '–ü–æ–ø—É–ª—è—Ä–Ω—ñ',
      searchPlaceholder: '–ü–æ—à—É–∫ –∑–∞ @id, —ñ–º\'—è–º –∞–±–æ #—Ö–µ—à—Ç–µ–≥–æ–º...',
      popularHashtags: '–ü–æ–ø—É–ª—è—Ä–Ω—ñ —Ö–µ—à—Ç–µ–≥–∏',
      searchUsersPlaceholder: '–ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...',
      messagePlaceholder: '–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...',
      sendBtn: '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏',
      settingsTitle: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è',
      themeBtn: '–¢–µ–º–∞',
      privacyBtn: '–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ',
      logoutBtn: '–í–∏–π—Ç–∏',
      privacyTitle: '–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ',
      privacyText1: '–¢–µ–∫—Å—Ç –ø–æ–ª—ñ—Ç–∏–∫–∏...',
    },
    ru: {
      navHome: '–ì–ª–∞–≤–Ω–∞—è',
      navSearch: '–ü–æ–∏—Å–∫',
      navHashtags: '–•–µ—à—Ç–µ–≥–∏',
      navProfile: '–ü—Ä–æ—Ñ–∏–ª—å',
      navChats: '–ß–∞—Ç—ã',
      navSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
      loginPlaceholder: '–ü—Å–µ–≤–¥–æ–Ω–∏–º (–±–µ–∑ @)',
      passwordPlaceholder: '–ü–∞—Ä–æ–ª—å',
      loginBtn: '–í–æ–π—Ç–∏',
      googleBtn: 'Google',
      appleBtn: 'Apple',
      noAccount: '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?',
      registerLink: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
      forgotPassword: '–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?',
      registerBtn: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
      haveAccount: '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?',
      loginLink: '–í–æ–π—Ç–∏',
      newPostPlaceholder: '–ß—Ç–æ –Ω–æ–≤–æ–≥–æ? #—Ö–µ—à—Ç–µ–≥',
      chooseMedia: '–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ',
      publishBtn: '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å',
      newBtn: '–ù–æ–≤—ã–µ',
      popularBtn: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ',
      searchPlaceholder: '–ü–æ–∏—Å–∫ –ø–æ @id, –∏–º–µ–Ω–∏ –∏–ª–∏ #—Ö–µ—à—Ç–µ–≥—É...',
      popularHashtags: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ö–µ—à—Ç–µ–≥–∏',
      searchUsersPlaceholder: '–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...',
      messagePlaceholder: '–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
      sendBtn: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
      settingsTitle: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
      themeBtn: '–¢–µ–º–∞',
      privacyBtn: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
      logoutBtn: '–í—ã–π—Ç–∏',
      privacyTitle: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
      privacyText1: '–¢–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏...',
    },
    en: {
      navHome: 'Home',
      navSearch: 'Search',
      navHashtags: 'Hashtags',
      navProfile: 'Profile',
      navChats: 'Chats',
      navSettings: 'Settings',
      loginPlaceholder: 'Nickname (without @)',
      passwordPlaceholder: 'Password',
      loginBtn: 'Login',
      googleBtn: 'Google',
      appleBtn: 'Apple',
      noAccount: 'No account?',
      registerLink: 'Register',
      forgotPassword: 'Forgot password?',
      registerBtn: 'Register',
      haveAccount: 'Already have an account?',
      loginLink: 'Login',
      newPostPlaceholder: 'What\'s new? #hashtag',
      chooseMedia: 'Choose photo/video',
      publishBtn: 'Publish',
      newBtn: 'New',
      popularBtn: 'Popular',
      searchPlaceholder: 'Search by @id, name or #hashtag...',
      popularHashtags: 'Popular hashtags',
      searchUsersPlaceholder: 'Search users...',
      messagePlaceholder: 'Write a message...',
      sendBtn: 'Send',
      settingsTitle: 'Settings',
      themeBtn: 'Theme',
      privacyBtn: 'Privacy Policy',
      logoutBtn: 'Logout',
      privacyTitle: 'Privacy Policy',
      privacyText1: 'Privacy policy text...',
    }
  };

  let currentLang = localStorage.getItem('lang') || 'uk';

  function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('lang', lang);
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (i18n[lang][key]) {
        el.innerText = i18n[lang][key];
      }
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.getAttribute('data-i18n-placeholder');
      if (i18n[lang][key]) {
        el.placeholder = i18n[lang][key];
      }
    });
    // –û–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É –∫–Ω–æ–ø–∫—É –º–æ–≤–∏
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });
  }

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
  });
  setLanguage(currentLang);

  // ================= –Ü–Ω—à—ñ –≥–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ (–∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É) =================
  let currentUser = null;
  let currentUserFollowing = [];
  let currentChatPartner = null;
  let currentChatPartnerName = '';
  let currentChatId = null;
  let currentProfileUid = null;
  let currentEditingPost = null;
  let unsubscribeFeed = null;
  let unsubscribeChat = null;
  let unsubscribeChatList = null;
  let unsubscribeTyping = null;
  let unsubscribeOnlineStatus = null;
  let unsubscribeFollowing = null;
  let lastOnlineInterval = null;
  let unreadCount = 0;
  let currentFeedType = 'new';
  let lastVisible = null;
  let loading = false;
  let hasMore = true;
  const viewedPosts = new Set();

  // ================= TV –ù–∞–≤—ñ–≥–∞—Ü—ñ—è (–ø–æ–∫—Ä–∞—â–µ–Ω–∞) =================
  let cachedFocusableElements = [];
  let lastDOMUpdate = 0;
  let lastFocusedElement = null;
  let tvCursorEnabled = true; // –∑–∞–≤–∂–¥–∏ –≤–≤—ñ–º–∫–Ω–µ–Ω–æ –¥–ª—è TV

  function getFocusableElements() {
    const activeModal = document.querySelector('.modal.active');
    let container = activeModal || document;
    const baseSelector = `
      button, input, textarea, select, a[href], 
      [tabindex]:not([tabindex="-1"]), 
      .nav-item, .post, .chat-item, .profile-tab, 
      .hashtag-item, .modal-close, .emoji-button, 
      .btn, .file-input-button, .post-actions button,
      .comment-author, .post-author, .avatar, .hashtag,
      .follow-btn-post, .profile-menu-btn, .profile-menu-item
    `;
    const elements = Array.from(container.querySelectorAll(baseSelector));
    return elements.filter(el => {
      const style = window.getComputedStyle(el);
      return style.display !== 'none' && style.visibility !== 'hidden' && el.offsetParent !== null && !el.disabled;
    });
  }

  function updateFocusableCache() {
    cachedFocusableElements = getFocusableElements();
    lastDOMUpdate = Date.now();
  }

  function getCenter(el) {
    const rect = el.getBoundingClientRect();
    return { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
  }

  function findClosestElement(currentEl, direction) {
    if (!currentEl) return null;
    const currentCenter = getCenter(currentEl);
    const candidates = cachedFocusableElements.filter(el => el !== currentEl);
    if (candidates.length === 0) return null;

    const dirMap = {
      'ArrowUp': { dx: 0, dy: -1 },
      'ArrowDown': { dx: 0, dy: 1 },
      'ArrowLeft': { dx: -1, dy: 0 },
      'ArrowRight': { dx: 1, dy: 0 }
    };
    const dir = dirMap[direction];
    if (!dir) return null;

    let best = null;
    let bestScore = Infinity;

    candidates.forEach(candidate => {
      const candidateCenter = getCenter(candidate);
      const dx = candidateCenter.x - currentCenter.x;
      const dy = candidateCenter.y - currentCenter.y;
      const dot = dx * dir.dx + dy * dir.dy;
      if (dot <= 0) return;
      const length = Math.sqrt(dx * dx + dy * dy);
      const cosAngle = dot / length;
      if (cosAngle < 0.5) return;
      const score = length / cosAngle;
      if (score < bestScore) {
        bestScore = score;
        best = candidate;
      }
    });
    return best;
  }

  function setFocusOnElement(el) {
    if (!el) return;
    document.querySelectorAll('.focused').forEach(e => e.classList.remove('focused'));
    el.classList.add('focused');
    el.focus({ preventScroll: true });
    el.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
    lastFocusedElement = el;
    updateTVCursor();
  }

  function closeAllPopups() {
    document.querySelectorAll('.emoji-picker').forEach(p => p.style.display = 'none');
    document.querySelectorAll('.profile-menu-dropdown.show').forEach(d => d.classList.remove('show'));
  }

  function handleKeyDown(e) {
    const arrowKeys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
    const isArrow = arrowKeys.includes(e.key);
    const isEnter = e.key === 'Enter';
    const isBack = e.key === 'Escape' || e.key === 'Back' || e.code === 'Escape';

    if (!isArrow && !isEnter && !isBack) return;

    if (Date.now() - lastDOMUpdate > 100) updateFocusableCache();

    const activeEl = document.activeElement;
    const isInput = activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'TEXTAREA' || activeEl.isContentEditable);

    if (isInput && (isArrow || isEnter)) return; // –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

    if (isBack) {
      e.preventDefault();
      // –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª–∫–∏, –µ–º–æ–¥–∂—ñ, –º–µ–Ω—é
      const openEmoji = document.querySelector('.emoji-picker[style*="display: grid"]');
      if (openEmoji) {
        openEmoji.style.display = 'none';
        if (lastFocusedElement) setFocusOnElement(lastFocusedElement);
        return;
      }
      const openDropdown = document.querySelector('.profile-menu-dropdown.show');
      if (openDropdown) {
        openDropdown.classList.remove('show');
        const menuBtn = document.querySelector('.profile-menu-btn');
        if (menuBtn) setFocusOnElement(menuBtn);
        return;
      }
      const activeModal = document.querySelector('.modal.active');
      if (activeModal) {
        activeModal.classList.remove('active');
        setTimeout(() => {
          updateFocusableCache();
          if (lastFocusedElement) setFocusOnElement(lastFocusedElement);
          else if (cachedFocusableElements[0]) setFocusOnElement(cachedFocusableElements[0]);
        }, 50);
        return;
      }
      const chatWindow = document.getElementById('chatWindow');
      if (chatWindow && chatWindow.style.display === 'flex') {
        chatWindow.style.display = 'none';
        setTimeout(() => {
          updateFocusableCache();
          const firstChat = document.querySelector('.chat-item');
          if (firstChat) setFocusOnElement(firstChat);
        }, 50);
        return;
      }
      // –ù–∞ –≥–æ–ª–æ–≤–Ω—É
      const homeNav = document.querySelector('[data-section="home"]');
      if (homeNav && !document.getElementById('home').classList.contains('active')) {
        homeNav.click();
      }
      return;
    }

    if (isEnter) {
      if (isInput) return;
      const focused = document.querySelector('.focused') || activeEl;
      if (focused) {
        e.preventDefault();
        focused.click();
      } else {
        e.preventDefault();
        if (cachedFocusableElements[0]) setFocusOnElement(cachedFocusableElements[0]);
      }
      return;
    }

    if (isArrow) {
      if (isInput) return;
      e.preventDefault();
      let current = document.querySelector('.focused') || activeEl;
      if (!current) {
        if (cachedFocusableElements[0]) setFocusOnElement(cachedFocusableElements[0]);
        return;
      }
      const emojiPicker = current.closest('.emoji-picker');
      if (emojiPicker && emojiPicker.style.display === 'grid') {
        const emojiButtons = Array.from(emojiPicker.querySelectorAll('button'));
        const currentIndex = emojiButtons.indexOf(current);
        if (currentIndex !== -1) {
          let nextIndex;
          const cols = 8;
          if (e.key === 'ArrowRight') nextIndex = currentIndex + 1;
          else if (e.key === 'ArrowLeft') nextIndex = currentIndex - 1;
          else if (e.key === 'ArrowDown') nextIndex = currentIndex + cols;
          else if (e.key === 'ArrowUp') nextIndex = currentIndex - cols;
          if (nextIndex >= 0 && nextIndex < emojiButtons.length) {
            setFocusOnElement(emojiButtons[nextIndex]);
          }
          return;
        }
      }
      const next = findClosestElement(current, e.key);
      if (next) setFocusOnElement(next);
    }
  }

  document.addEventListener('keydown', handleKeyDown);

  function updateTVCursor() {
    const cursor = document.getElementById('tvCursor');
    if (!cursor) return;
    if (!tvCursorEnabled) {
      cursor.style.display = 'none';
      return;
    }
    const focusedEl = document.querySelector('.focused');
    if (!focusedEl) {
      cursor.style.display = 'none';
      return;
    }
    const rect = focusedEl.getBoundingClientRect();
    cursor.style.display = 'block';
    cursor.style.left = (rect.left - 20) + 'px';
    cursor.style.top = (rect.top + rect.height/2 - 24) + 'px';
  }

  const observer = new MutationObserver(updateFocusableCache);
  observer.observe(document.body, { childList: true, subtree: true, attributes: true });

  window.addEventListener('load', () => {
    setTimeout(() => {
      updateFocusableCache();
      const first = cachedFocusableElements[0];
      if (first) setFocusOnElement(first);
    }, 500);
  });

  // ================= –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (–∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É) =================
  const showToast = (msg) => {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
  };

  const vibrate = (ms) => { if (navigator.vibrate) navigator.vibrate(ms); };

  const updateUnreadBadge = () => {
    const badge = document.getElementById('unreadBadge');
    if (badge) {
      if (unreadCount > 0) {
        badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
        badge.style.display = 'inline-block';
      } else {
        badge.style.display = 'none';
      }
    }
  };

  // ... (—Ç—É—Ç –º–∞—é—Ç—å –±—É—Ç–∏ –≤—Å—ñ —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è, –ø–æ—Å—Ç–∏, —á–∞—Ç–∏, —Ç–æ—â–æ)
  // –û—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –∑–∞–π–º–∞—é—Ç—å –±–∞–≥–∞—Ç–æ –º—ñ—Å—Ü—è, –∞–ª–µ –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—ñ –≤–æ–Ω–∏ –≤–∂–µ —î, –º–∏ —ó—Ö –∑–∞–ª–∏—à–∞—î–º–æ.
  // –î–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —è –Ω–µ –±—É–¥—É –∫–æ–ø—ñ—é–≤–∞—Ç–∏ —ó—Ö –ø–æ–≤–Ω—ñ—Å—Ç—é, –∞–ª–µ –ø—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ –≤–æ–Ω–∏ —Ç—É—Ç –ø—Ä–∏—Å—É—Ç–Ω—ñ.
  // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ –≤–µ—Å—å JS –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ —Ä—è–¥–∫–∞.
  // –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ —Å–∫–æ—Ä–æ—á–µ–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —ñ–∑ –∫–ª—é—á–æ–≤–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏.

  // ================= –ö–æ–ø—ñ—é—î–º–æ —Ä–µ—à—Ç—É —Ñ—É–Ω–∫—Ü—ñ–π –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥—É =================
  // (reportUser, muteUser, blockUser, –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Ä–æ–∑–¥—ñ–ª–∞—Ö, setupEmojiPicker, setupFileInput, loadHashtags, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è, onAuthStateChanged, loadMorePosts, renderPosts, toggleFollow, loadChatList, openChat, sendMessage —Ç–æ—â–æ)
  // –í –æ—Ä–∏–≥—ñ–Ω–∞–ª—ñ –≤–æ–Ω–∏ —î, —Ç–æ–º—É —ó—Ö –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å—é–¥–∏.
  // –î–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –º—ñ—Å—Ü—è —è –Ω–µ –¥—É–±–ª—é—é —ó—Ö, –∞–ª–µ –≤ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ –≤–æ–Ω–∏ –º–∞—é—Ç—å –±—É—Ç–∏.

  // –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ–¥–∞–º–æ –±–∞–∑–æ–≤—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é:
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      document.getElementById('authBox').style.display = 'none';
      document.getElementById('newPostBox').style.display = 'block';
      // ... —ñ–Ω—à—ñ –¥—ñ—ó
    } else {
      currentUser = null;
      document.getElementById('authBox').style.display = 'block';
      document.getElementById('newPostBox').style.display = 'none';
    }
  });

  // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      const section = item.dataset.section;
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      item.classList.add('active');
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(section).classList.add('active');
      document.getElementById('pageTitle').innerText = item.innerText;
      // ... –∑–∞–∫—Ä–∏—Ç—Ç—è —Å–∞–π–¥–±–∞—Ä—É —Ç–æ—â–æ
      setTimeout(updateFocusableCache, 200);
    });
  });

  // –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏)
  window.setLanguage = setLanguage; // –¥–ª—è –¥–æ—Å—Ç—É–ø—É –∑–∑–æ–≤–Ω—ñ

  console.log('TV-–¥–æ–¥–∞—Ç–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
</script>
</body>
</html>
