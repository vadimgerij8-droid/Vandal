<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>SAYS UA ¬∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –¥–∂–µ—Ä–µ–ª–∞</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
    <style>
        /* ========== –°–¢–ò–õ–Ü (—ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó) ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0c0c0c; color: #f0f0f0; font-family: 'Inter', sans-serif; line-height: 1.5; -webkit-font-smoothing: antialiased; }
        .app { max-width: 1440px; margin: 0 auto; padding: 0 20px; padding-bottom: 80px; }
        .header { position: sticky; top: 0; z-index: 100; background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.05); padding: 16px 0 8px; margin-bottom: 20px; }
        .header-top { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
        .logo { font-size: 2rem; font-weight: 800; letter-spacing: -0.02em; background: linear-gradient(135deg, #fff, #f5c518); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none; }
        .search-box { display: flex; align-items: center; background: rgba(30, 30, 30, 0.7); border-radius: 40px; padding: 8px 18px; width: 300px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; backdrop-filter: blur(4px); }
        .search-box:focus-within { border-color: #f5c518; background: rgba(40, 40, 40, 0.9); box-shadow: 0 0 0 2px rgba(245, 197, 24, 0.2); }
        .search-box i { color: #f5c518; margin-right: 10px; }
        .search-box input { background: transparent; border: none; color: white; width: 100%; outline: none; font-size: 0.95rem; }
        .search-box input::placeholder { color: #aaa; }
        .user-icon { color: #f5c518; font-size: 2rem; cursor: pointer; transition: transform 0.2s; }
        .user-icon:hover { transform: scale(1.05); }
        .nav-links { display: flex; gap: 32px; font-weight: 500; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; overflow-x: auto; white-space: nowrap; scrollbar-width: none; margin-top: 10px; }
        .nav-links::-webkit-scrollbar { display: none; }
        .nav-links a { color: #aaa; text-decoration: none; font-size: 1rem; transition: color 0.2s; cursor: pointer; padding-bottom: 8px; border-bottom: 2px solid transparent; }
        .nav-links a.active { color: #f5c518; border-bottom-color: #f5c518; }
        .trending-section { margin: 30px 0 20px; }
        .section-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .section-title i { color: #f5c518; }
        .trending-scroll { display: flex; gap: 16px; overflow-x: auto; scroll-snap-type: x mandatory; padding-bottom: 12px; }
        .trending-scroll::-webkit-scrollbar { height: 6px; }
        .trending-scroll::-webkit-scrollbar-thumb { background: #f5c518; border-radius: 10px; }
        .trending-scroll::-webkit-scrollbar-track { background: #2a2a2a; }
        .trend-card { flex: 0 0 160px; scroll-snap-align: start; background: #151515; border-radius: 20px; overflow: hidden; border: 1px solid #2a2a2a; transition: transform 0.2s; cursor: pointer; }
        .trend-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(245,197,24,0.1); border-color: #f5c518; }
        .trend-poster { aspect-ratio: 2 / 3; background: linear-gradient(145deg, #2a2a2a, #1a1a1a); display: flex; align-items: center; justify-content: center; color: #555; font-size: 2.5rem; }
        .trend-poster span { opacity: 0.6; }
        .trend-info { padding: 12px; }
        .trend-info h4 { font-size: 0.9rem; font-weight: 600; color: white; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .filter-section { margin: 28px 0 20px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 16px; }
        .genre-chips { display: flex; flex-wrap: wrap; gap: 10px; }
        .chip { background: rgba(30,30,30,0.7); backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.05); color: #ccc; padding: 8px 18px; border-radius: 40px; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .chip:hover { background: #2a2a2a; border-color: #f5c518; color: white; }
        .chip.active { background: #f5c518; color: black; border-color: #f5c518; font-weight: 600; }
        .sort-control { display: flex; align-items: center; gap: 8px; color: #f5c518; }
        .sort-control select { background: rgba(30,30,30,0.8); backdrop-filter: blur(4px); border: 1px solid #333; color: white; padding: 8px 28px 8px 14px; border-radius: 30px; font-size: 0.9rem; outline: none; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5c518' stroke-width='2'><polyline points='6 9 12 15 18 9'/></svg>"); background-repeat: no-repeat; background-position: right 8px center; }
        .movies-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 24px 16px; margin: 32px 0 48px; }
        .movie-card { background: #151515; border-radius: 20px; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s; border: 1px solid #2a2a2a; display: flex; flex-direction: column; cursor: pointer; position: relative; }
        .movie-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 30px rgba(245,197,24,0.15); border-color: #f5c518; }
        .card-poster { aspect-ratio: 2 / 3; background: linear-gradient(145deg, #2a2a2a, #1a1a1a); display: flex; align-items: center; justify-content: center; color: #555; font-size: 3rem; border-bottom: 1px solid #2a2a2a; position: relative; background-size: cover; background-position: center; }
        .card-poster span { opacity: 0.5; }
        .card-badge { position: absolute; top: 10px; right: 10px; background: rgba(245,197,24,0.9); color: black; font-size: 0.7rem; font-weight: 700; padding: 4px 8px; border-radius: 30px; display: flex; align-items: center; gap: 4px; }
        .watchlist-badge { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #f5c518; font-size: 1rem; padding: 5px; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border: 1px solid #f5c518; opacity: 0; transition: opacity 0.2s; }
        .movie-card:hover .watchlist-badge { opacity: 1; }
        .card-info { padding: 14px 12px 12px; display: flex; flex-direction: column; gap: 8px; }
        .card-title { font-weight: 700; font-size: 1rem; line-height: 1.3; color: white; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; min-height: 42px; }
        .card-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 6px 8px; font-size: 0.8rem; color: #aaa; }
        .card-year { background: #1f1f1f; padding: 2px 10px; border-radius: 30px; }
        .card-imdb { display: flex; align-items: center; gap: 4px; background: #2b2b2b; padding: 2px 8px; border-radius: 30px; color: #f5c518; font-weight: 600; }
        .card-genres { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
        .genre-tag { background: #1a1a1a; color: #bbb; font-size: 0.7rem; padding: 3px 10px; border-radius: 30px; border: 1px solid #2f2f2f; }
        .card-type { font-size: 0.7rem; text-transform: uppercase; color: #f5c518; letter-spacing: 0.4px; margin-top: 6px; }
        .no-results { grid-column: 1 / -1; text-align: center; padding: 60px; color: #666; font-size: 1.2rem; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.9); backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-around; padding: 10px 0 20px; z-index: 200; display: none; }
        .bottom-nav a { color: #aaa; font-size: 1.4rem; transition: color 0.2s; cursor: pointer; text-align: center; flex: 1; }
        .bottom-nav a.active { color: #f5c518; }
        .bottom-nav span { display: block; font-size: 0.7rem; margin-top: 4px; }
        @media (max-width: 700px) {
            .app { padding: 0 16px 70px; }
            .header-top .search-box { width: 100%; order: 3; }
            .nav-links { display: none; }
            .bottom-nav { display: flex; }
            .trend-card { flex: 0 0 130px; }
            .movies-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        }
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background: #151515; width: 90%; max-width: 800px; border-radius: 30px; border: 1px solid #333; overflow: hidden; box-shadow: 0 30px 60px rgba(0,0,0,0.7); transform: scale(0.95); animation: scaleIn 0.3s forwards; }
        @keyframes scaleIn { to { transform: scale(1); } }
        .modal-header { padding: 20px 24px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #2a2a2a; }
        .modal-header h2 { font-size: 1.5rem; font-weight: 700; color: white; max-width: 80%; }
        .close-modal { background: none; border: none; color: #aaa; font-size: 2.2rem; cursor: pointer; transition: color 0.2s; line-height: 1; }
        .close-modal:hover { color: #f5c518; }
        .modal-body { padding: 24px; }
        .player-container { background: #1a1a1a; border-radius: 20px; aspect-ratio: 16 / 9; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; border: 1px solid #333; margin-bottom: 20px; background-image: radial-gradient(circle at 30% 30%, #2a2a2a, #111); overflow: hidden; }
        .player-container iframe { width: 100%; height: 100%; border: none; }
        .play-btn { background: #f5c518; color: black; border: none; font-size: 1.2rem; font-weight: 700; padding: 14px 40px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: transform 0.2s; box-shadow: 0 10px 20px rgba(245,197,24,0.3); margin: 10px 0; }
        .play-btn:hover { background: #ffd966; transform: scale(1.03); }
        .modal-details { color: #ccc; font-size: 0.95rem; line-height: 1.6; margin-top: 16px; }
        .sources-list { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .source-btn { background: #2a2a2a; border: 1px solid #444; color: #f5c518; padding: 8px 16px; border-radius: 40px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .source-btn:hover { background: #f5c518; color: black; border-color: #f5c518; }
        .watchlist-btn { background: transparent; border: 1px solid #f5c518; color: #f5c518; padding: 10px 20px; border-radius: 40px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 10px; display: inline-flex; align-items: center; gap: 8px; }
        .watchlist-btn:hover { background: #f5c518; color: black; }
        .watchlist-btn.active { background: #f5c518; color: black; }
        .ukr-badge { display: inline-block; background: #2b2b2b; color: #f5c518; padding: 4px 12px; border-radius: 30px; font-size: 0.8rem; font-weight: 600; margin-left: 10px; border: 1px solid #444; }
        .footer { border-top: 1px solid #222; padding: 30px 0 40px; color: #666; font-size: 0.9rem; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; }
        .footer a { color: #aaa; text-decoration: none; margin-right: 24px; cursor: pointer; transition: color 0.2s; }
        .footer a:hover { color: #f5c518; }
    </style>
</head>
<body>
<div class="app">
    <header class="header">
        <div class="header-top">
            <div class="logo">SAYS UA</div>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="search" id="searchInput" placeholder="–ü–æ—à—É–∫ —Ñ—ñ–ª—å–º—ñ–≤, —Å–µ—Ä—ñ–∞–ª—ñ–≤..." aria-label="–ü–æ—à—É–∫">
            </div>
            <div class="user-icon" id="userIcon">
                <i class="far fa-user-circle"></i>
            </div>
        </div>
        <div class="nav-links" id="navLinks">
            <a data-nav="home" class="active">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a data-nav="movies">–§—ñ–ª—å–º–∏</a>
            <a data-nav="series">–°–µ—Ä—ñ–∞–ª–∏</a>
            <a data-nav="cartoons">–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏</a>
            <a data-nav="collections">–î–æ–±—ñ—Ä–∫–∏</a>
            <a data-nav="ratings">–†–µ–π—Ç–∏–Ω–≥–∏</a>
        </div>
    </header>

    <section class="trending-section" id="trendingSection">
        <div class="section-title"><i class="fas fa-fire"></i> –£ —Ç—Ä–µ–Ω–¥—ñ</div>
        <div class="trending-scroll" id="trendingScroll"></div>
    </section>

    <div class="filter-section">
        <div class="genre-chips" id="genreChips"></div>
        <div class="sort-control">
            <span><i class="fas fa-sort"></i></span>
            <select id="sortSelect">
                <option value="default">–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º</option>
                <option value="rating">–∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º IMDb</option>
                <option value="year">–∑–∞ —Ä–æ–∫–æ–º (–Ω–æ–≤—ñ—à—ñ)</option>
            </select>
        </div>
    </div>

    <main>
        <div class="movies-grid" id="moviesGrid">
            <div class="no-results">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>
    </main>

    <footer class="footer">
        <div>¬© 2025 SAYS UA ‚Äî —Ç–≤—ñ–π —Å—Ç–∏–ª—å–Ω–∏–π –∫—ñ–Ω–æ—Ç–µ–∞—Ç—Ä</div>
        <div>
            <a id="footerAbout">–ü—Ä–æ –Ω–∞—Å</a>
            <a id="footerApi">API</a>
            <a id="footerSupport">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</a>
        </div>
    </footer>
</div>

<div class="bottom-nav">
    <a data-nav="home" class="active"><i class="fas fa-home"></i><span>–ì–æ–ª–æ–≤–Ω–∞</span></a>
    <a data-nav="movies"><i class="fas fa-film"></i><span>–§—ñ–ª—å–º–∏</span></a>
    <a data-nav="series"><i class="fas fa-tv"></i><span>–°–µ—Ä—ñ–∞–ª–∏</span></a>
    <a data-nav="cartoons"><i class="fas fa-child"></i><span>–ú—É–ª—å—Ç–∏</span></a>
    <a data-nav="watchlist"><i class="fas fa-bookmark"></i><span>–ú–æ—î</span></a>
</div>

<div class="modal" id="videoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">–ù–∞–∑–≤–∞</h2>
            <button class="close-modal" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="player-container" id="playerContainer">
                <i class="fas fa-play-circle" style="font-size: 5rem; color: #f5c518; opacity: 0.6;"></i>
                <button class="play-btn" id="playDefaultBtn"><i class="fas fa-play"></i> –î–∏–≤–∏—Ç–∏—Å—å</button>
                <div style="color:#f5c518; font-size:0.85rem;">—Ä–µ–∫–ª–∞–º–∞ –≤—ñ–¥—Å—É—Ç–Ω—è ¬∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é</div>
            </div>
            <div class="modal-details" id="modalDetails">
                <p><strong>–†—ñ–∫:</strong> <span id="modalYear"></span></p>
                <p><strong>–ñ–∞–Ω—Ä–∏:</strong> <span id="modalGenres"></span></p>
                <p><strong>–†–µ–π—Ç–∏–Ω–≥ IMDb:</strong> <span id="modalImdb"></span></p>
                <p><strong>–¢–∏–ø:</strong> <span id="modalType"></span> <span class="ukr-badge">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é</span></p>
                
                <!-- –°–ø–∏—Å–æ–∫ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª -->
                <div class="sources-list" id="sourcesList"></div>
                
                <button class="watchlist-btn" id="watchlistToggle"><i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É</button>
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        // ========== –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ==========
        const TMDB_API_KEY = '–í–ê–®_–ö–õ–Æ–ß_TMDB';  // ‚ö†Ô∏è –í—Å—Ç–∞–≤—Ç–µ —Å—é–¥–∏ –≤–∞—à –∫–ª—é—á
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        
        // –ü—Ä–æ–∫—Å—ñ –¥–ª—è –æ–±—Ö–æ–¥—É CORS (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π, –∞–ª–µ –º–∞—î –ª—ñ–º—ñ—Ç–∏)
        const PROXY_URL = 'https://api.allorigins.win/raw?url=';

        // –°–ø–∏—Å–æ–∫ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –ø—ñ—Ä–∞—Ç—Å—å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
        const UA_SOURCES = [
            {
                name: 'UAKino',
                domain: 'uakino.club',
                searchUrl: (title, year) => `https://uakino.club/index.php?do=search&subaction=search&story=${encodeURIComponent(title)}`,
                extractEmbed: (html) => {
                    // –®—É–∫–∞—î–º–æ –ø–µ—Ä—à–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ—ñ–ª—å–º
                    const match = html.match(/<a href="(https:\/\/uakino\.club\/\d+-[^"]+\.html)"/);
                    if (match) {
                        // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ embed-–≤–µ—Ä—Å—ñ—é (–∑–∞–º—ñ–Ω—é—î–º–æ .html –Ω–∞ /embed/)
                        return match[1].replace('.html', '/embed/');
                    }
                    return null;
                }
            },
            {
                name: 'Kinogo',
                domain: 'kinogo.ec',
                searchUrl: (title, year) => `https://kinogo.ec/index.php?do=search&subaction=search&story=${encodeURIComponent(title)}`,
                extractEmbed: (html) => {
                    const match = html.match(/<a href="(https:\/\/kinogo\.ec\/\d+-[^"]+\.html)"/);
                    if (match) {
                        return match[1].replace('.html', '/embed/');
                    }
                    return null;
                }
            },
            {
                name: 'HDRezka',
                domain: 'hdrezka.ag',
                searchUrl: (title, year) => `https://hdrezka.ag/search/?q=${encodeURIComponent(title)}`,
                extractEmbed: (html) => {
                    // HDRezka –º–∞—î —Å–∫–ª–∞–¥–Ω—ñ—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Å–ø—Ä–æ—â–µ–Ω–æ
                    const match = html.match(/data-id="(\d+)" data-type="([^"]+)"/);
                    if (match) {
                        const id = match[1];
                        const type = match[2]; // 'film' –∞–±–æ 'series'
                        return `https://hdrezka.ag/embed/${type}/${id}/`;
                    }
                    return null;
                }
            }
        ];

        // ========== TMBD –§–£–ù–ö–¶–Ü–á ==========
        async function fetchTMDB(endpoint, params = {}) {
            try {
                const url = new URL(`${TMDB_BASE_URL}${endpoint}`);
                url.searchParams.append('api_key', TMDB_API_KEY);
                url.searchParams.append('language', 'uk-UA');
                Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
                const response = await fetch(url);
                return await response.json();
            } catch (error) {
                console.error('TMDB error:', error);
                return null;
            }
        }

        async function fetchPopularMovies() {
            const data = await fetchTMDB('/movie/popular', { page: 1 });
            return data?.results || [];
        }

        async function fetchMovieDetails(id, type) {
            return await fetchTMDB(`/${type}/${id}`, { append_to_response: 'videos,credits' });
        }

        async function searchMulti(query) {
            const data = await fetchTMDB('/search/multi', { query });
            return data?.results || [];
        }

        // ========== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –ü–û–®–£–ö–£ –ù–ê –ü–Ü–†–ê–¢–°–¨–ö–ò–• –°–ê–ô–¢–ê–• ==========
        async function fetchViaProxy(url) {
            try {
                const response = await fetch(PROXY_URL + encodeURIComponent(url));
                return await response.text();
            } catch (error) {
                console.warn('Proxy error:', error);
                return '';
            }
        }

        async function findEmbedUrl(source, title, year) {
            const searchUrl = source.searchUrl(title, year);
            const html = await fetchViaProxy(searchUrl);
            return source.extractEmbed(html);
        }

        async function findAllEmbeds(title, year) {
            const promises = UA_SOURCES.map(async src => {
                const embed = await findEmbedUrl(src, title, year);
                return embed ? { name: src.name, url: embed } : null;
            });
            const results = await Promise.all(promises);
            return results.filter(r => r !== null);
        }

        // ========== –°–¢–ê–ù ==========
        let activeGenre = '–£—Å—ñ';
        let currentSort = 'default';
        let activeNav = 'home';
        let searchQuery = '';
        let watchlist = JSON.parse(localStorage.getItem('saysua_watchlist')) || [];
        let allGenres = ['–£—Å—ñ', '–î—Ä–∞–º–∞', '–ö–æ–º–µ–¥—ñ—è', '–ï–∫—à–Ω', '–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞', '–ñ–∞—Ö–∏', '–¢—Ä–∏–ª–µ—Ä', '–î–µ—Ç–µ–∫—Ç–∏–≤', '–ü—Ä–∏–≥–æ–¥–∏', '–ê–Ω—ñ–º–∞—Ü—ñ—è'];

        // DOM
        const grid = document.getElementById('moviesGrid');
        const chipsContainer = document.getElementById('genreChips');
        const sortSelect = document.getElementById('sortSelect');
        const searchInput = document.getElementById('searchInput');
        const navLinks = document.querySelectorAll('#navLinks a, .bottom-nav a');
        const userIcon = document.getElementById('userIcon');
        const trendingScroll = document.getElementById('trendingScroll');
        const modal = document.getElementById('videoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalYear = document.getElementById('modalYear');
        const modalGenres = document.getElementById('modalGenres');
        const modalImdb = document.getElementById('modalImdb');
        const modalType = document.getElementById('modalType');
        const playerContainer = document.getElementById('playerContainer');
        const playDefaultBtn = document.getElementById('playDefaultBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const watchlistToggle = document.getElementById('watchlistToggle');
        const sourcesList = document.getElementById('sourcesList');

        let currentMovieId = null;
        let currentMovieTitle = '';
        let currentMovieYear = '';

        // ========== –†–ï–ù–î–ï–† ==========
        function renderMovies(moviesArray) {
            if (!moviesArray.length) {
                grid.innerHTML = `<div class="no-results">üòï –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>`;
                return;
            }

            let html = '';
            moviesArray.forEach(m => {
                const posterPath = m.poster_path ? `${IMAGE_BASE_URL}${m.poster_path}` : null;
                const posterLetters = (m.title || m.name || '??').slice(0, 2).toUpperCase();
                const year = (m.release_date || m.first_air_date || '').split('-')[0] || '‚Äî';
                const imdb = m.vote_average ? m.vote_average.toFixed(1) : '‚Äî';
                const type = m.media_type === 'tv' ? 'series' : (m.media_type === 'movie' ? 'movie' : 'movie');
                const typeLabel = type === 'series' ? '—Å–µ—Ä—ñ–∞–ª' : (type === 'movie' ? '—Ñ—ñ–ª—å–º' : '–º—É–ª—å—Ç—Ñ—ñ–ª—å–º');
                const inWatchlist = watchlist.includes(m.id) ? 'fa-solid' : 'fa-regular';

                html += `
                    <div class="movie-card" data-id="${m.id}" data-type="${type}" data-title="${m.title || m.name}" data-year="${year}">
                        <div class="card-poster" style="${posterPath ? `background-image: url('${posterPath}')` : ''}">
                            ${!posterPath ? `<span>${posterLetters}</span>` : ''}
                            <div class="watchlist-badge"><i class="${inWatchlist} fa-bookmark"></i></div>
                        </div>
                        <div class="card-info">
                            <div class="card-title">${m.title || m.name}</div>
                            <div class="card-meta">
                                <span class="card-year">${year}</span>
                                <span class="card-imdb"><i class="fab fa-imdb"></i> ${imdb}</span>
                            </div>
                            <div class="card-type">${typeLabel} ¬∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é</div>
                        </div>
                    </div>
                `;
            });
            grid.innerHTML = html;

            document.querySelectorAll('.movie-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = parseInt(card.dataset.id);
                    const type = card.dataset.type;
                    const title = card.dataset.title;
                    const year = card.dataset.year;
                    openModal(id, type, title, year);
                });
            });
        }

        async function openModal(id, type, title, year) {
            currentMovieId = id;
            currentMovieTitle = title;
            currentMovieYear = year;

            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–µ—Ç–∞–ª—ñ –∑ TMDB (–¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö)
            const tmdbData = await fetchMovieDetails(id, type);
            
            modalTitle.textContent = tmdbData.title || tmdbData.name || title;
            modalYear.textContent = (tmdbData.release_date || tmdbData.first_air_date || '').split('-')[0] || year;
            modalGenres.textContent = tmdbData.genres?.map(g => g.name).join(', ') || '‚Äî';
            modalImdb.textContent = tmdbData.vote_average?.toFixed(1) || '‚Äî';
            modalType.textContent = type === 'tv' ? '–°–µ—Ä—ñ–∞–ª' : '–§—ñ–ª—å–º';

            // –û—á–∏—â–∞—î–º–æ –ø–ª–µ—î—Ä —ñ –∫–Ω–æ–ø–∫–∏
            playerContainer.innerHTML = `<i class="fas fa-play-circle" style="font-size: 5rem; color: #f5c518; opacity: 0.6;"></i>`;
            sourcesList.innerHTML = '<i>–ü–æ—à—É–∫ –¥–∂–µ—Ä–µ–ª... <i class="fas fa-spinner fa-spin"></i></i>';

            // –®—É–∫–∞—î–º–æ –¥–∂–µ—Ä–µ–ª–∞ –Ω–∞ –ø—ñ—Ä–∞—Ç—Å—å–∫–∏—Ö —Å–∞–π—Ç–∞—Ö
            const embeds = await findAllEmbeds(title, year);
            
            if (embeds.length === 0) {
                sourcesList.innerHTML = '<i>–î–∂–µ—Ä–µ–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</i>';
                playDefaultBtn.onclick = () => alert('–ù–∞ –∂–∞–ª—å, –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É.');
            } else {
                sourcesList.innerHTML = '';
                embeds.forEach(embed => {
                    const btn = document.createElement('button');
                    btn.className = 'source-btn';
                    btn.textContent = embed.name;
                    btn.onclick = () => {
                        playerContainer.innerHTML = `<iframe src="${embed.url}" allowfullscreen></iframe>`;
                    };
                    sourcesList.appendChild(btn);
                });
                playDefaultBtn.onclick = () => {
                    if (embeds[0]) {
                        playerContainer.innerHTML = `<iframe src="${embeds[0].url}" allowfullscreen></iframe>`;
                    }
                };
            }

            // –ö–Ω–æ–ø–∫–∞ —Å–ø–∏—Å–∫—É –ø–µ—Ä–µ–≥–ª—è–¥—É
            if (watchlist.includes(id)) {
                watchlistToggle.innerHTML = '<i class="fas fa-bookmark"></i> –£ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.add('active');
            } else {
                watchlistToggle.innerHTML = '<i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.remove('active');
            }

            modal.classList.add('active');
        }

        // ========== –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ì–û–õ–û–í–ù–û–á ==========
        async function loadHome() {
            const popular = await fetchPopularMovies();
            renderMovies(popular.map(m => ({ ...m, media_type: 'movie' })));

            // –¢—Ä–µ–Ω–¥–∏
            const trending = popular.slice(0, 10);
            let trendHtml = '';
            trending.forEach(m => {
                trendHtml += `
                    <div class="trend-card" data-id="${m.id}" data-type="movie" data-title="${m.title}" data-year="${(m.release_date || '').split('-')[0]}">
                        <div class="trend-poster"><span>${(m.title || '??').slice(0,2)}</span></div>
                        <div class="trend-info">
                            <h4>${m.title}</h4>
                            <div class="trend-meta"><i class="fas fa-star"></i> ${m.vote_average?.toFixed(1)}</div>
                        </div>
                    </div>
                `;
            });
            trendingScroll.innerHTML = trendHtml;
            document.querySelectorAll('.trend-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = parseInt(card.dataset.id);
                    const type = card.dataset.type;
                    const title = card.dataset.title;
                    const year = card.dataset.year;
                    openModal(id, type, title, year);
                });
            });

            renderChips();
        }

        function renderChips() {
            chipsContainer.innerHTML = '';
            allGenres.forEach(genre => {
                const chip = document.createElement('span');
                chip.className = `chip ${activeGenre === genre ? 'active' : ''}`;
                chip.textContent = genre;
                chip.dataset.genre = genre;
                chip.addEventListener('click', () => {
                    activeGenre = genre;
                    renderChips();
                    // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ–∫–∏ —â–æ –∑–∞–≥–ª—É—à–∫–∞
                });
                chipsContainer.appendChild(chip);
            });
        }

        // ========== –ù–ê–í–Ü–ì–ê–¶–Ü–Ø ==========
        function setActiveNav(targetNav) {
            navLinks.forEach(link => {
                if (link.dataset.nav === targetNav) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            activeNav = targetNav;
            if (targetNav === 'home') loadHome();
            else if (targetNav === 'watchlist') {
                // TODO: –ø–æ–∫–∞–∑–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ
            }
        }

        // ========== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ==========
        loadHome();

        // –°–ª—É—Ö–∞—á—ñ
        searchInput.addEventListener('input', (e) => {
            clearTimeout(window.searchTimeout);
            window.searchTimeout = setTimeout(async () => {
                const query = e.target.value.trim();
                if (query.length > 2) {
                    const results = await searchMulti(query);
                    renderMovies(results);
                } else if (query.length === 0) {
                    loadHome();
                }
            }, 500);
        });

        sortSelect.addEventListener('change', (e) => {
            currentSort = e.target.value;
            // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–∫–∏ —â–æ –∑–∞–≥–ª—É—à–∫–∞
        });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveNav(link.dataset.nav);
            });
        });

        userIcon.addEventListener('click', () => alert('üë§ –û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç (–¥–µ–º–æ)'));

        closeModalBtn.addEventListener('click', () => modal.classList.remove('active'));
        window.addEventListener('click', (e) => {
            if (e.target === modal) modal.classList.remove('active');
        });

        watchlistToggle.addEventListener('click', () => {
            if (!currentMovieId) return;
            const idx = watchlist.indexOf(currentMovieId);
            if (idx === -1) {
                watchlist.push(currentMovieId);
                watchlistToggle.innerHTML = '<i class="fas fa-bookmark"></i> –£ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.add('active');
            } else {
                watchlist.splice(idx, 1);
                watchlistToggle.innerHTML = '<i class="far fa-bookmark"></i> –î–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É';
                watchlistToggle.classList.remove('active');
            }
            localStorage.setItem('saysua_watchlist', JSON.stringify(watchlist));
        });

        setActiveNav('home');
    })();
</script>
</body>
</html>
